Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tree=void 0;let constants_1=require("./constants"),Branch_1=require("./Branch"),join_1=require("./join"),DEFAULT_INITIALIZER={name:"DEFAULT_INITIALIZER",delta:function(e,n){return n.val}};class Tree{constructor(e,n,t){this.forest=e,this.dataEngine=t.dataEngine,console.log("engine for",this.dataEngine,"is",this.engine),this.engine.actions.has(constants_1.ACTION_NAME_INITIALIZER)?(e=this.engine.actions.get(constants_1.ACTION_NAME_INITIALIZER),this.root=new Branch_1.Branch(this,e,t)):this.root=new Branch_1.Branch(this,DEFAULT_INITIALIZER,t)}get top(){let e=this.root;for(;e;){if(!e.next)return e;e=e.next}return e}get engine(){return this._engine||(this._engine=this.forest.dataEngine(this.dataEngine,this)),this._engine}get value(){return this.top.value}do(e,n,t){var i=this.engine.actions.get(e);if(i)return i=new Branch_1.Branch(this,i,n,t),(0,join_1.join)(this.top,i),i;throw new Error("engine "+this.dataEngine+" does not have an action "+e)}}exports.Tree=Tree;