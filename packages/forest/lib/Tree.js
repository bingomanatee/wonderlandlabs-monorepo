Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tree=void 0;let constants_1=require("./constants"),Branch_1=require("./Branch"),join_1=require("./join"),DEFAULT_INITIALIZER={name:"DEFAULT_INITIALIZER",delta:function(e,n){return n[0]}};class Tree{constructor(e,n,t){this.forest=e,this.name=n,this.dataEngine=t.dataEngine;e=[t.val],console.log(t.dataEngine,"init is ",e),n=this.engine.actions.has(constants_1.ACTION_NAME_INITIALIZER)?this.engine.actions.get(constants_1.ACTION_NAME_INITIALIZER):DEFAULT_INITIALIZER;this.root=new Branch_1.Branch(this,n,e)}get top(){let e=this.root;for(;e;){if(!e.next)return e;e=e.next}return e}get engine(){return this._engine||(this._engine=this.forest.dataEngine(this.dataEngine,this)),this._engine}get value(){return this.top.value}do(e,...n){var t=this.engine.actions.get(e);if(t)return t=new Branch_1.Branch(this,t,n),(0,join_1.join)(this.top,t),t;throw new Error("engine "+this.dataEngine+" does not have an action "+e)}}exports.Tree=Tree;