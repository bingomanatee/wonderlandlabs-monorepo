"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.idStr=exports.validateField=exports.compareMaps=void 0;const lodash_1=require("lodash"),ErrorPlus_1=require("./ErrorPlus"),walrus_1=require("@wonderlandlabs/walrus");function compareMaps(t,a,e){var r;return e.identity?(r=t.get(e.identity),e=a.get(e.identity),(0,lodash_1.isEqual)(r,e)):t.size===a.size&&Array.from(t.keys()).every(e=>{var r=t.get(e),e=a.get(e);return r===e||(0,lodash_1.isEqual)(r,e)})}function validateField(e,r,t){if(r.name in e){var a=e[r.name],i=walrus_1.type.describe(a,!0);if(r.type)if(Array.isArray(r.type)){if(!r.type.includes(i))throw new ErrorPlus_1.ErrorPlus(`field ${r.name} does not match any allowed type`,{def:r,value:e,collection:t.name})}else if(i!==r.type)throw i={type:r.type,field:r.name,value:e,collection:t.name},new ErrorPlus_1.ErrorPlus("field does not match allowed type",i);if(r.validator)if(r.validator(a,t))throw new ErrorPlus_1.ErrorPlus("failed validation filter for "+r.name,{field:r.name,value:e,collection:t.name})}else if(!r.optional)throw new ErrorPlus_1.ErrorPlus(`validation error: ${t.name} record missing required field `+r.name,{data:e,collection:t,field:r.name})}function idStr(e){return"symbol"==typeof e?e.toString():""+e}exports.compareMaps=compareMaps,exports.validateField=validateField,exports.idStr=idStr;