var Ft=function(t,e){return Ft=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Ft(t,e)};function q(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ft(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Rt(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Dt(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(c){s={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function Ut(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function P(t){return typeof t=="function"}function Ye(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var xt=Ye(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Vt(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var mt=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=Rt(s),a=c.next();!a.done;a=c.next()){var u=a.value;u.remove(this)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(P(f))try{f()}catch(l){o=l instanceof xt?l.errors:[l]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Rt(d),v=h.next();!v.done;v=h.next()){var g=v.value;try{ce(g)}catch(l){o=o??[],l instanceof xt?o=Ut(Ut([],Dt(o)),Dt(l.errors)):o.push(l)}}}catch(l){n={error:l}}finally{try{v&&!v.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(o)throw new xt(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)ce(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&Vt(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&Vt(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),We=mt.EMPTY;function Xe(t){return t instanceof mt||t&&"closed"in t&&P(t.remove)&&P(t.add)&&P(t.unsubscribe)}function ce(t){P(t)?t():t.unsubscribe()}var _r={Promise:void 0},gr={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,Ut([t,e],Dt(r)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function mr(t){gr.setTimeout(function(){throw t})}function fe(){}function ht(t){t()}var te=(function(t){q(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Xe(r)&&r.add(n)):n.destination=Ar,n}return e.create=function(r,n,i){return new Lt(r,n,i)},e.prototype.next=function(r){this.isStopped||this._next(r)},e.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(mt),wr=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){ut(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){ut(n)}else ut(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){ut(r)}},t})(),Lt=(function(t){q(e,t);function e(r,n,i){var o=t.call(this)||this,s;return P(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new wr(s),o}return e})(te);function ut(t){mr(t)}function Sr(t){throw t}var Ar={closed:!0,next:fe,error:Sr,complete:fe},Pr=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Tr(t){return t}function Er(t){return t.length===0?Tr:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var le=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,o=xr(e)?e:new Lt(e,r,n);return ht(function(){var s=i,c=s.operator,a=s.source;o.add(c?c.call(o,a):a?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=he(r),new r(function(i,o){var s=new Lt({next:function(c){try{e(c)}catch(a){o(a),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[Pr]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Er(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=he(e),new e(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},t.create=function(e){return new t(e)},t})();function he(t){var e;return(e=t??_r.Promise)!==null&&e!==void 0?e:Promise}function Or(t){return t&&P(t.next)&&P(t.error)&&P(t.complete)}function xr(t){return t&&t instanceof te||Or(t)&&Xe(t)}function jr(t){return P(t?.lift)}function $r(t){return function(e){if(jr(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Cr(t,e,r,n,i){return new Mr(t,e,r,n,i)}var Mr=(function(t){q(e,t);function e(r,n,i,o,s,c){var a=t.call(this,r)||this;return a.onFinalize=s,a.shouldUnsubscribe=c,a._next=n?function(u){try{n(u)}catch(f){r.error(f)}}:t.prototype._next,a._error=o?function(u){try{o(u)}catch(f){r.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e})(te),Ir=Ye(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),wt=(function(t){q(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new pe(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new Ir},e.prototype.next=function(r){var n=this;ht(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=Rt(n.currentObservers),c=s.next();!c.done;c=s.next()){var a=c.value;a.next(r)}}catch(u){i={error:u}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(r){var n=this;ht(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},e.prototype.complete=function(){var r=this;ht(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,c=i.observers;return o||s?We:(this.currentObservers=null,c.push(r),new mt(function(){n.currentObservers=null,Vt(c,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},e.prototype.asObservable=function(){var r=new le;return r.source=this,r},e.create=function(r,n){return new pe(r,n)},e})(le),pe=(function(t){q(e,t);function e(r,n){var i=t.call(this)||this;return i.destination=r,i.source=n,i}return e.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},e.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:We},e})(wt),de=(function(t){q(e,t);function e(r){var n=t.call(this)||this;return n._value=r,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(r){var n=t.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},e.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},e.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},e})(wt);function zr(t,e){return $r(function(r,n){var i=0;r.subscribe(Cr(n,function(o){n.next(t.call(e,o,i++))}))})}var Ze=typeof global=="object"&&global&&global.Object===Object&&global,Fr=typeof self=="object"&&self&&self.Object===Object&&self,O=Ze||Fr||Function("return this")(),z=O.Symbol,Je=Object.prototype,Rr=Je.hasOwnProperty,Dr=Je.toString,W=z?z.toStringTag:void 0;function Ur(t){var e=Rr.call(t,W),r=t[W];try{t[W]=void 0;var n=!0}catch{}var i=Dr.call(t);return n&&(e?t[W]=r:delete t[W]),i}var Vr=Object.prototype,Lr=Vr.toString;function Br(t){return Lr.call(t)}var Gr="[object Null]",Nr="[object Undefined]",ye=z?z.toStringTag:void 0;function K(t){return t==null?t===void 0?Nr:Gr:ye&&ye in Object(t)?Ur(t):Br(t)}function G(t){return t!=null&&typeof t=="object"}var Hr="[object Symbol]";function ee(t){return typeof t=="symbol"||G(t)&&K(t)==Hr}function qr(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var U=Array.isArray,ve=z?z.prototype:void 0,be=ve?ve.toString:void 0;function Qe(t){if(typeof t=="string")return t;if(U(t))return qr(t,Qe)+"";if(ee(t))return be?be.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function ke(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Kr="[object AsyncFunction]",Yr="[object Function]",Wr="[object GeneratorFunction]",Xr="[object Proxy]";function tr(t){if(!ke(t))return!1;var e=K(t);return e==Yr||e==Wr||e==Kr||e==Xr}var jt=O["__core-js_shared__"],_e=(function(){var t=/[^.]+$/.exec(jt&&jt.keys&&jt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function Zr(t){return!!_e&&_e in t}var Jr=Function.prototype,Qr=Jr.toString;function B(t){if(t!=null){try{return Qr.call(t)}catch{}try{return t+""}catch{}}return""}var kr=/[\\^$.*+?()[\]{}|]/g,tn=/^\[object .+?Constructor\]$/,en=Function.prototype,rn=Object.prototype,nn=en.toString,on=rn.hasOwnProperty,sn=RegExp("^"+nn.call(on).replace(kr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function an(t){if(!ke(t)||Zr(t))return!1;var e=tr(t)?sn:tn;return e.test(B(t))}function un(t,e){return t?.[e]}function Y(t,e){var r=un(t,e);return an(r)?r:void 0}var Bt=Y(O,"WeakMap"),cn=9007199254740991,fn=/^(?:0|[1-9]\d*)$/;function ln(t,e){var r=typeof t;return e=e??cn,!!e&&(r=="number"||r!="symbol"&&fn.test(t))&&t>-1&&t%1==0&&t<e}function er(t,e){return t===e||t!==t&&e!==e}var hn=9007199254740991;function rr(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=hn}function pn(t){return t!=null&&rr(t.length)&&!tr(t)}var dn=Object.prototype;function yn(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||dn;return t===r}function vn(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var bn="[object Arguments]";function ge(t){return G(t)&&K(t)==bn}var nr=Object.prototype,_n=nr.hasOwnProperty,gn=nr.propertyIsEnumerable,mn=ge((function(){return arguments})())?ge:function(t){return G(t)&&_n.call(t,"callee")&&!gn.call(t,"callee")};function wn(){return!1}var ir=typeof exports=="object"&&exports&&!exports.nodeType&&exports,me=ir&&typeof module=="object"&&module&&!module.nodeType&&module,Sn=me&&me.exports===ir,we=Sn?O.Buffer:void 0,An=we?we.isBuffer:void 0,Gt=An||wn,Pn="[object Arguments]",Tn="[object Array]",En="[object Boolean]",On="[object Date]",xn="[object Error]",jn="[object Function]",$n="[object Map]",Cn="[object Number]",Mn="[object Object]",In="[object RegExp]",zn="[object Set]",Fn="[object String]",Rn="[object WeakMap]",Dn="[object ArrayBuffer]",Un="[object DataView]",Vn="[object Float32Array]",Ln="[object Float64Array]",Bn="[object Int8Array]",Gn="[object Int16Array]",Nn="[object Int32Array]",Hn="[object Uint8Array]",qn="[object Uint8ClampedArray]",Kn="[object Uint16Array]",Yn="[object Uint32Array]",y={};y[Vn]=y[Ln]=y[Bn]=y[Gn]=y[Nn]=y[Hn]=y[qn]=y[Kn]=y[Yn]=!0;y[Pn]=y[Tn]=y[Dn]=y[En]=y[Un]=y[On]=y[xn]=y[jn]=y[$n]=y[Cn]=y[Mn]=y[In]=y[zn]=y[Fn]=y[Rn]=!1;function Wn(t){return G(t)&&rr(t.length)&&!!y[K(t)]}function Xn(t){return function(e){return t(e)}}var or=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Z=or&&typeof module=="object"&&module&&!module.nodeType&&module,Zn=Z&&Z.exports===or,$t=Zn&&Ze.process,Se=(function(){try{var t=Z&&Z.require&&Z.require("util").types;return t||$t&&$t.binding&&$t.binding("util")}catch{}})(),Ae=Se&&Se.isTypedArray,sr=Ae?Xn(Ae):Wn,Jn=Object.prototype,Qn=Jn.hasOwnProperty;function kn(t,e){var r=U(t),n=!r&&mn(t),i=!r&&!n&&Gt(t),o=!r&&!n&&!i&&sr(t),s=r||n||i||o,c=s?vn(t.length,String):[],a=c.length;for(var u in t)Qn.call(t,u)&&!(s&&(u=="length"||i&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||ln(u,a)))&&c.push(u);return c}function ti(t,e){return function(r){return t(e(r))}}var ei=ti(Object.keys,Object),ri=Object.prototype,ni=ri.hasOwnProperty;function ii(t){if(!yn(t))return ei(t);var e=[];for(var r in Object(t))ni.call(t,r)&&r!="constructor"&&e.push(r);return e}function oi(t){return pn(t)?kn(t):ii(t)}var si=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ai=/^\w*$/;function ui(t,e){if(U(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||ee(t)?!0:ai.test(t)||!si.test(t)||e!=null&&t in Object(e)}var Q=Y(Object,"create");function ci(){this.__data__=Q?Q(null):{},this.size=0}function fi(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var li="__lodash_hash_undefined__",hi=Object.prototype,pi=hi.hasOwnProperty;function di(t){var e=this.__data__;if(Q){var r=e[t];return r===li?void 0:r}return pi.call(e,t)?e[t]:void 0}var yi=Object.prototype,vi=yi.hasOwnProperty;function bi(t){var e=this.__data__;return Q?e[t]!==void 0:vi.call(e,t)}var _i="__lodash_hash_undefined__";function gi(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Q&&e===void 0?_i:e,this}function V(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}V.prototype.clear=ci;V.prototype.delete=fi;V.prototype.get=di;V.prototype.has=bi;V.prototype.set=gi;function mi(){this.__data__=[],this.size=0}function St(t,e){for(var r=t.length;r--;)if(er(t[r][0],e))return r;return-1}var wi=Array.prototype,Si=wi.splice;function Ai(t){var e=this.__data__,r=St(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():Si.call(e,r,1),--this.size,!0}function Pi(t){var e=this.__data__,r=St(e,t);return r<0?void 0:e[r][1]}function Ti(t){return St(this.__data__,t)>-1}function Ei(t,e){var r=this.__data__,n=St(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function x(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}x.prototype.clear=mi;x.prototype.delete=Ai;x.prototype.get=Pi;x.prototype.has=Ti;x.prototype.set=Ei;var k=Y(O,"Map");function Oi(){this.size=0,this.__data__={hash:new V,map:new(k||x),string:new V}}function xi(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function At(t,e){var r=t.__data__;return xi(e)?r[typeof e=="string"?"string":"hash"]:r.map}function ji(t){var e=At(this,t).delete(t);return this.size-=e?1:0,e}function $i(t){return At(this,t).get(t)}function Ci(t){return At(this,t).has(t)}function Mi(t,e){var r=At(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function j(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}j.prototype.clear=Oi;j.prototype.delete=ji;j.prototype.get=$i;j.prototype.has=Ci;j.prototype.set=Mi;var Ii="Expected a function";function re(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Ii);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(re.Cache||j),r}re.Cache=j;var zi=500;function Fi(t){var e=re(t,function(n){return r.size===zi&&r.clear(),n}),r=e.cache;return e}var Ri=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Di=/\\(\\)?/g,Ui=Fi(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Ri,function(r,n,i,o){e.push(i?o.replace(Di,"$1"):n||r)}),e});function Vi(t){return t==null?"":Qe(t)}function Li(t,e){return U(t)?t:ui(t,e)?[t]:Ui(Vi(t))}function Bi(t){if(typeof t=="string"||ee(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function Gi(t,e){e=Li(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Bi(e[r++])];return r&&r==n?t:void 0}function Ni(t,e,r){var n=t==null?void 0:Gi(t,e);return n===void 0?r:n}function Hi(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}function qi(){this.__data__=new x,this.size=0}function Ki(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Yi(t){return this.__data__.get(t)}function Wi(t){return this.__data__.has(t)}var Xi=200;function Zi(t,e){var r=this.__data__;if(r instanceof x){var n=r.__data__;if(!k||n.length<Xi-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new j(n)}return r.set(t,e),this.size=r.size,this}function M(t){var e=this.__data__=new x(t);this.size=e.size}M.prototype.clear=qi;M.prototype.delete=Ki;M.prototype.get=Yi;M.prototype.has=Wi;M.prototype.set=Zi;function Ji(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var s=t[r];e(s,r,t)&&(o[i++]=s)}return o}function Qi(){return[]}var ki=Object.prototype,to=ki.propertyIsEnumerable,Pe=Object.getOwnPropertySymbols,eo=Pe?function(t){return t==null?[]:(t=Object(t),Ji(Pe(t),function(e){return to.call(t,e)}))}:Qi;function ro(t,e,r){var n=e(t);return U(t)?n:Hi(n,r(t))}function Te(t){return ro(t,oi,eo)}var Nt=Y(O,"DataView"),Ht=Y(O,"Promise"),qt=Y(O,"Set"),Ee="[object Map]",no="[object Object]",Oe="[object Promise]",xe="[object Set]",je="[object WeakMap]",$e="[object DataView]",io=B(Nt),oo=B(k),so=B(Ht),ao=B(qt),uo=B(Bt),C=K;(Nt&&C(new Nt(new ArrayBuffer(1)))!=$e||k&&C(new k)!=Ee||Ht&&C(Ht.resolve())!=Oe||qt&&C(new qt)!=xe||Bt&&C(new Bt)!=je)&&(C=function(t){var e=K(t),r=e==no?t.constructor:void 0,n=r?B(r):"";if(n)switch(n){case io:return $e;case oo:return Ee;case so:return Oe;case ao:return xe;case uo:return je}return e});var Ce=O.Uint8Array,co="__lodash_hash_undefined__";function fo(t){return this.__data__.set(t,co),this}function lo(t){return this.__data__.has(t)}function dt(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new j;++e<r;)this.add(t[e])}dt.prototype.add=dt.prototype.push=fo;dt.prototype.has=lo;function ho(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function po(t,e){return t.has(e)}var yo=1,vo=2;function ar(t,e,r,n,i,o){var s=r&yo,c=t.length,a=e.length;if(c!=a&&!(s&&a>c))return!1;var u=o.get(t),f=o.get(e);if(u&&f)return u==e&&f==t;var d=-1,h=!0,v=r&vo?new dt:void 0;for(o.set(t,e),o.set(e,t);++d<c;){var g=t[d],l=e[d];if(n)var $=s?n(l,g,d,e,t,o):n(g,l,d,t,e,o);if($!==void 0){if($)continue;h=!1;break}if(v){if(!ho(e,function(F,R){if(!po(v,R)&&(g===F||i(g,F,r,n,o)))return v.push(R)})){h=!1;break}}else if(!(g===l||i(g,l,r,n,o))){h=!1;break}}return o.delete(t),o.delete(e),h}function bo(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}function _o(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var go=1,mo=2,wo="[object Boolean]",So="[object Date]",Ao="[object Error]",Po="[object Map]",To="[object Number]",Eo="[object RegExp]",Oo="[object Set]",xo="[object String]",jo="[object Symbol]",$o="[object ArrayBuffer]",Co="[object DataView]",Me=z?z.prototype:void 0,Ct=Me?Me.valueOf:void 0;function Mo(t,e,r,n,i,o,s){switch(r){case Co:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case $o:return!(t.byteLength!=e.byteLength||!o(new Ce(t),new Ce(e)));case wo:case So:case To:return er(+t,+e);case Ao:return t.name==e.name&&t.message==e.message;case Eo:case xo:return t==e+"";case Po:var c=bo;case Oo:var a=n&go;if(c||(c=_o),t.size!=e.size&&!a)return!1;var u=s.get(t);if(u)return u==e;n|=mo,s.set(t,e);var f=ar(c(t),c(e),n,i,o,s);return s.delete(t),f;case jo:if(Ct)return Ct.call(t)==Ct.call(e)}return!1}var Io=1,zo=Object.prototype,Fo=zo.hasOwnProperty;function Ro(t,e,r,n,i,o){var s=r&Io,c=Te(t),a=c.length,u=Te(e),f=u.length;if(a!=f&&!s)return!1;for(var d=a;d--;){var h=c[d];if(!(s?h in e:Fo.call(e,h)))return!1}var v=o.get(t),g=o.get(e);if(v&&g)return v==e&&g==t;var l=!0;o.set(t,e),o.set(e,t);for(var $=s;++d<a;){h=c[d];var F=t[h],R=e[h];if(n)var ue=s?n(R,F,h,e,t,o):n(F,R,h,t,e,o);if(!(ue===void 0?F===R||i(F,R,r,n,o):ue)){l=!1;break}$||($=h=="constructor")}if(l&&!$){var st=t.constructor,at=e.constructor;st!=at&&"constructor"in t&&"constructor"in e&&!(typeof st=="function"&&st instanceof st&&typeof at=="function"&&at instanceof at)&&(l=!1)}return o.delete(t),o.delete(e),l}var Do=1,Ie="[object Arguments]",ze="[object Array]",ct="[object Object]",Uo=Object.prototype,Fe=Uo.hasOwnProperty;function Vo(t,e,r,n,i,o){var s=U(t),c=U(e),a=s?ze:C(t),u=c?ze:C(e);a=a==Ie?ct:a,u=u==Ie?ct:u;var f=a==ct,d=u==ct,h=a==u;if(h&&Gt(t)){if(!Gt(e))return!1;s=!0,f=!1}if(h&&!f)return o||(o=new M),s||sr(t)?ar(t,e,r,n,i,o):Mo(t,e,a,r,n,i,o);if(!(r&Do)){var v=f&&Fe.call(t,"__wrapped__"),g=d&&Fe.call(e,"__wrapped__");if(v||g){var l=v?t.value():t,$=g?e.value():e;return o||(o=new M),i(l,$,r,n,o)}}return h?(o||(o=new M),Ro(t,e,r,n,i,o)):!1}function ur(t,e,r,n,i){return t===e?!0:t==null||e==null||!G(t)&&!G(e)?t!==t&&e!==e:Vo(t,e,r,n,ur,i)}function cr(t,e){return ur(t,e)}function X(t){return t instanceof Error?t:t?typeof t=="string"?new Error(t):new Error("unknown / bad error in Forestry"):new Error("(unknown error in Forestry (maybe a validation test?)")}function pt(t){return typeof t=="object"&&t!==null}function Lo(t){return pt(t)&&typeof t.parse=="function"}function Bo(t){return pt(t)&&"value"in t&&typeof t.next=="function"&&pt(t?.acts)&&pt(t?.$)}var fr=Symbol.for("immer-nothing"),Re=Symbol.for("immer-draftable"),p=Symbol.for("immer-state");function A(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var N=Object.getPrototypeOf;function H(t){return!!t&&!!t[p]}function E(t){return t?lr(t)||Array.isArray(t)||!!t[Re]||!!t.constructor?.[Re]||ot(t)||Tt(t):!1}var Go=Object.prototype.constructor.toString();function lr(t){if(!t||typeof t!="object")return!1;const e=N(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Go}function tt(t,e){Pt(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,n)=>e(n,r,t))}function Pt(t){const e=t[p];return e?e.type_:Array.isArray(t)?1:ot(t)?2:Tt(t)?3:0}function Kt(t,e){return Pt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function hr(t,e,r){const n=Pt(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function No(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function ot(t){return t instanceof Map}function Tt(t){return t instanceof Set}function _(t){return t.copy_||t.base_}function Yt(t,e){if(ot(t))return new Map(t);if(Tt(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=lr(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[p];let i=Reflect.ownKeys(n);for(let o=0;o<i.length;o++){const s=i[o],c=n[s];c.writable===!1&&(c.writable=!0,c.configurable=!0),(c.get||c.set)&&(n[s]={configurable:!0,writable:!0,enumerable:c.enumerable,value:t[s]})}return Object.create(N(t),n)}else{const n=N(t);if(n!==null&&r)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function ne(t,e=!1){return Et(t)||H(t)||!E(t)||(Pt(t)>1&&Object.defineProperties(t,{set:{value:ft},add:{value:ft},clear:{value:ft},delete:{value:ft}}),Object.freeze(t),e&&Object.values(t).forEach(r=>ne(r,!0))),t}function ft(){A(2)}function Et(t){return Object.isFrozen(t)}var Wt={};function L(t){const e=Wt[t];return e||A(0,t),e}function Ho(t,e){Wt[t]||(Wt[t]=e)}var et;function yt(){return et}function qo(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function De(t,e){e&&(L("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function Xt(t){Zt(t),t.drafts_.forEach(Ko),t.drafts_=null}function Zt(t){t===et&&(et=t.parent_)}function Ue(t){return et=qo(et,t)}function Ko(t){const e=t[p];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function Ve(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[p].modified_&&(Xt(e),A(4)),E(t)&&(t=vt(e,t),e.parent_||bt(e,t)),e.patches_&&L("Patches").generateReplacementPatches_(r[p].base_,t,e.patches_,e.inversePatches_)):t=vt(e,r,[]),Xt(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==fr?t:void 0}function vt(t,e,r){if(Et(e))return e;const n=e[p];if(!n)return tt(e,(i,o)=>Le(t,n,e,i,o,r)),e;if(n.scope_!==t)return e;if(!n.modified_)return bt(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let o=i,s=!1;n.type_===3&&(o=new Set(i),i.clear(),s=!0),tt(o,(c,a)=>Le(t,n,i,c,a,r,s)),bt(t,i,!1),r&&t.patches_&&L("Patches").generatePatches_(n,r,t.patches_,t.inversePatches_)}return n.copy_}function Le(t,e,r,n,i,o,s){if(H(i)){const c=o&&e&&e.type_!==3&&!Kt(e.assigned_,n)?o.concat(n):void 0,a=vt(t,i,c);if(hr(r,n,a),H(a))t.canAutoFreeze_=!1;else return}else s&&r.add(i);if(E(i)&&!Et(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;vt(t,i),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&(ot(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))&&bt(t,i)}}function bt(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&ne(e,r)}function Yo(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:yt(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,o=ie;r&&(i=[n],o=rt);const{revoke:s,proxy:c}=Proxy.revocable(i,o);return n.draft_=c,n.revoke_=s,c}var ie={get(t,e){if(e===p)return t;const r=_(t);if(!Kt(r,e))return Wo(t,r,e);const n=r[e];return t.finalized_||!E(n)?n:n===Mt(t.base_,e)?(It(t),t.copy_[e]=nt(n,t)):n},has(t,e){return e in _(t)},ownKeys(t){return Reflect.ownKeys(_(t))},set(t,e,r){const n=pr(_(t),e);if(n?.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const i=Mt(_(t),e),o=i?.[p];if(o&&o.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(No(r,i)&&(r!==void 0||Kt(t.base_,e)))return!0;It(t),T(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return Mt(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,It(t),T(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=_(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){A(11)},getPrototypeOf(t){return N(t.base_)},setPrototypeOf(){A(12)}},rt={};tt(ie,(t,e)=>{rt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});rt.deleteProperty=function(t,e){return rt.set.call(this,t,e,void 0)};rt.set=function(t,e,r){return ie.set.call(this,t[0],e,r,t[0])};function Mt(t,e){const r=t[p];return(r?_(r):t)[e]}function Wo(t,e,r){const n=pr(e,r);return n?"value"in n?n.value:n.get?.call(t.draft_):void 0}function pr(t,e){if(!(e in t))return;let r=N(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=N(r)}}function T(t){t.modified_||(t.modified_=!0,t.parent_&&T(t.parent_))}function It(t){t.copy_||(t.copy_=Yt(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var Xo=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const o=r;r=e;const s=this;return function(a=o,...u){return s.produce(a,f=>r.call(this,f,...u))}}typeof r!="function"&&A(6),n!==void 0&&typeof n!="function"&&A(7);let i;if(E(e)){const o=Ue(this),s=nt(e,void 0);let c=!0;try{i=r(s),c=!1}finally{c?Xt(o):Zt(o)}return De(o,n),Ve(i,o)}else if(!e||typeof e!="object"){if(i=r(e),i===void 0&&(i=e),i===fr&&(i=void 0),this.autoFreeze_&&ne(i,!0),n){const o=[],s=[];L("Patches").generateReplacementPatches_(e,i,o,s),n(o,s)}return i}else A(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(s,...c)=>this.produceWithPatches(s,a=>e(a,...c));let n,i;return[this.produce(e,r,(s,c)=>{n=s,i=c}),n,i]},typeof t?.autoFreeze=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof t?.useStrictShallowCopy=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){E(t)||A(8),H(t)&&(t=Zo(t));const e=Ue(this),r=nt(t,void 0);return r[p].isManual_=!0,Zt(e),r}finishDraft(t,e){const r=t&&t[p];(!r||!r.isManual_)&&A(9);const{scope_:n}=r;return De(n,e),Ve(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const i=e[r];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}r>-1&&(e=e.slice(r+1));const n=L("Patches").applyPatches_;return H(t)?n(t,e):this.produce(t,i=>n(i,e))}};function nt(t,e){const r=ot(t)?L("MapSet").proxyMap_(t,e):Tt(t)?L("MapSet").proxySet_(t,e):Yo(t,e);return(e?e.scope_:yt()).drafts_.push(r),r}function Zo(t){return H(t)||A(10,t),dr(t)}function dr(t){if(!E(t)||Et(t))return t;const e=t[p];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=Yt(t,e.scope_.immer_.useStrictShallowCopy_)}else r=Yt(t,!0);return tt(r,(n,i)=>{hr(r,n,dr(i))}),e&&(e.finalized_=!1),r}function Jo(){class t extends Map{constructor(a,u){super(),this[p]={type_:2,parent_:u,scope_:u?u.scope_:yt(),modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:a,draft_:this,isManual_:!1,revoked_:!1}}get size(){return _(this[p]).size}has(a){return _(this[p]).has(a)}set(a,u){const f=this[p];return s(f),(!_(f).has(a)||_(f).get(a)!==u)&&(r(f),T(f),f.assigned_.set(a,!0),f.copy_.set(a,u),f.assigned_.set(a,!0)),this}delete(a){if(!this.has(a))return!1;const u=this[p];return s(u),r(u),T(u),u.base_.has(a)?u.assigned_.set(a,!1):u.assigned_.delete(a),u.copy_.delete(a),!0}clear(){const a=this[p];s(a),_(a).size&&(r(a),T(a),a.assigned_=new Map,tt(a.base_,u=>{a.assigned_.set(u,!1)}),a.copy_.clear())}forEach(a,u){const f=this[p];_(f).forEach((d,h,v)=>{a.call(u,this.get(h),h,this)})}get(a){const u=this[p];s(u);const f=_(u).get(a);if(u.finalized_||!E(f)||f!==u.base_.get(a))return f;const d=nt(f,u);return r(u),u.copy_.set(a,d),d}keys(){return _(this[p]).keys()}values(){const a=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{const u=a.next();return u.done?u:{done:!1,value:this.get(u.value)}}}}entries(){const a=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{const u=a.next();if(u.done)return u;const f=this.get(u.value);return{done:!1,value:[u.value,f]}}}}[Symbol.iterator](){return this.entries()}}function e(c,a){return new t(c,a)}function r(c){c.copy_||(c.assigned_=new Map,c.copy_=new Map(c.base_))}class n extends Set{constructor(a,u){super(),this[p]={type_:3,parent_:u,scope_:u?u.scope_:yt(),modified_:!1,finalized_:!1,copy_:void 0,base_:a,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1}}get size(){return _(this[p]).size}has(a){const u=this[p];return s(u),u.copy_?!!(u.copy_.has(a)||u.drafts_.has(a)&&u.copy_.has(u.drafts_.get(a))):u.base_.has(a)}add(a){const u=this[p];return s(u),this.has(a)||(o(u),T(u),u.copy_.add(a)),this}delete(a){if(!this.has(a))return!1;const u=this[p];return s(u),o(u),T(u),u.copy_.delete(a)||(u.drafts_.has(a)?u.copy_.delete(u.drafts_.get(a)):!1)}clear(){const a=this[p];s(a),_(a).size&&(o(a),T(a),a.copy_.clear())}values(){const a=this[p];return s(a),o(a),a.copy_.values()}entries(){const a=this[p];return s(a),o(a),a.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(a,u){const f=this.values();let d=f.next();for(;!d.done;)a.call(u,d.value,d.value,this),d=f.next()}}function i(c,a){return new n(c,a)}function o(c){c.copy_||(c.copy_=new Set,c.base_.forEach(a=>{if(E(a)){const u=nt(a,c);c.drafts_.set(a,u),c.copy_.add(u)}else c.copy_.add(a)}))}function s(c){c.revoked_&&A(3,JSON.stringify(_(c)))}Ho("MapSet",{proxyMap_:e,proxySet_:i})}var Qo=new Xo,J=Qo.produce;function ko(t,e){return Array.from(Object.keys(t)).reduce((r,n)=>{const i=t[n];return r[n]=function(...o){return i.call(e,e.value,...o)},r},{})}function ts(t,e){return Array.isArray(t)?t.map(r=>function(n){return r.call(e,n,e)}):function(r){return t.call(e,r,e)}}const m={scalar:"scalar",array:"array",map:"map",object:"object",set:"set",function:"function",container:"container",void:"void"},w={undefined:"undefined",object:"object",boolean:"boolean",number:"number",bigint:"bigint",string:"string",symbol:"symbol",function:"function"},b={string:"string",number:"number",boolean:"boolean",symbol:"symbol",array:"array",map:"map",object:"object",set:"set",null:"null",undefined:"undefined",function:"function"};class S{constructor(e,r,n,i){this.type=e,this.form=r,this.typeOf=n,this.test=i}get family(){return[m.scalar,m.void,m.function].includes(this.form)?this.form:m.container}includes(e,r){return r?!(r!==this.typeOf||this.test&&!this.test(e)):this.includes(e,typeof e)}}const Be=[new S(b.undefined,m.void,w.undefined),new S(b.null,m.void,w.object,t=>t===null),new S(b.boolean,m.scalar,w.boolean),new S(b.string,m.scalar,w.string),new S(b.number,m.scalar,w.number),new S(b.number,m.scalar,w.bigint),new S(b.symbol,m.scalar,w.symbol),new S(b.function,m.function,w.function),new S(b.array,m.array,w.object,t=>Array.isArray(t)),new S(b.map,m.map,w.object,t=>t instanceof Map),new S(b.set,m.set,w.object,t=>t instanceof Set),new S(b.object,m.object,w.object,t=>t&&typeof t=="object")],_t=(t,e=!1)=>{if(e){const n=_t(t);if(typeof n=="object"){if(e===!0)return n.type;if(e==="type"||e==="form"||e==="typeOf"||e==="family")return n[e]}return n}const r=typeof t;for(let n=0;n<Be.length;++n){const i=Be[n];if(i.includes(t,r))return i}throw console.error("describe failure to analyze",t),new Error("cannot analyze value")};function it(t,e){return Array.isArray(e)?e.reduce((n,i)=>{if(n==null)return;switch(_t(n,!0)){case b.map:return n.get(i);case b.array:{if(typeof i=="number")return n[i];const s=parseInt(i,10);return isNaN(s)?void 0:n[s]}case b.object:return n[i];default:return}},t):it(t,e.split("."))}function Ot(t,e,r){if(!Array.isArray(e))return Ot(t,e.split("."),r);const[n]=e.slice(0,e.length-1).reduce(([s],c)=>{const a=_t(s,!0);switch(a){case b.map:return s.has(c)||s.set(c,{}),[s.get(c)];case b.array:{if(typeof c=="number")return s[c];const u=parseInt(c,10);if(isNaN(u))throw new Error(`Invalid array index: ${c}`);return s[u]===void 0&&(s[u]={}),[s[u]]}case b.object:return(s[c]===void 0||s[c]===null)&&(s[c]={}),[s[c]];default:throw new Error(`Cannot set nested value on type: ${a}`)}},[t]),i=e[e.length-1],o=_t(n,!0);switch(o){case b.map:n.set(i,r);break;case b.array:if(typeof i=="number")n[i]=r;else{const s=parseInt(i,10);if(isNaN(s))throw new Error(`Invalid array index: ${i}`);n[s]=r}break;case b.object:n[i]=r;break;default:throw new Error(`Cannot set value on type: ${o}`)}}function Ge(t){if(Array.isArray(t))return t;if(typeof t=="string")return t.split(".");if(t instanceof RegExp)return[t];throw console.log("unparsable path: ",t),new Error("cannot parse path")}function I(t){return Array.isArray(t)?t.join("."):`${t}`}function gt(t,e){return Array.isArray(t)?Array.isArray(e)?t.length?e.length?[...t,...e]:t:e:gt(t,Ge(e)):gt(Ge(t),e)}function es(t){return t}function D(t){return typeof t=="function"}function rs(t){return D(t?.lift)}function ns(t){return function(e){if(rs(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var Jt=function(t,e){return Jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},Jt(t,e)};function oe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Jt(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Ne(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Qt(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(c){s={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function kt(t,e,r){if(arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function is(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var zt=is(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function He(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var se=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var c=Ne(s),a=c.next();!a.done;a=c.next()){var u=a.value;u.remove(this)}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(D(f))try{f()}catch(l){o=l instanceof zt?l.errors:[l]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var h=Ne(d),v=h.next();!v.done;v=h.next()){var g=v.value;try{qe(g)}catch(l){o=o??[],l instanceof zt?o=kt(kt([],Qt(o)),Qt(l.errors)):o.push(l)}}}catch(l){n={error:l}}finally{try{v&&!v.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}if(o)throw new zt(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)qe(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&He(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&He(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})();se.EMPTY;function os(t){return t instanceof se||t&&"closed"in t&&D(t.remove)&&D(t.add)&&D(t.unsubscribe)}function qe(t){D(t)?t():t.unsubscribe()}var ss={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,kt([t,e],Qt(r)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function as(t){ss.setTimeout(function(){throw t})}function Ke(){}var yr=(function(t){oe(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,os(r)&&r.add(n)):n.destination=ls,n}return e.create=function(r,n,i){return new cs(r,n,i)},e.prototype.next=function(r){this.isStopped||this._next(r)},e.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(se),us=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){lt(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){lt(n)}else lt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){lt(r)}},t})(),cs=(function(t){oe(e,t);function e(r,n,i){var o=t.call(this)||this,s;return D(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new us(s),o}return e})(yr);function lt(t){as(t)}function fs(t){throw t}var ls={closed:!0,next:Ke,error:fs,complete:Ke};function hs(t,e,r,n,i){return new ps(t,e,r,n,i)}var ps=(function(t){oe(e,t);function e(r,n,i,o,s,c){var a=t.call(this,r)||this;return a.onFinalize=s,a.shouldUnsubscribe=c,a._next=n?function(u){try{n(u)}catch(f){r.error(f)}}:t.prototype._next,a._error=o?function(u){try{o(u)}catch(f){r.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(u){r.error(u)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e})(yr);function vr(t,e){return e===void 0&&(e=es),t=t??ds,ns(function(r,n){var i,o=!0;r.subscribe(hs(n,function(s){var c=e(s);(o||!t(i,c))&&(o=!1,i=c,n.next(s))}))})}function ds(t,e){return t===e}Jo();class br{constructor(e,r=!1){r||(this.#e=new de(e.value)),"schema"in e&&e.schema&&(this.schema=e.schema),this.debug=!!e.debug;const n=this;this.$=ko(e.actions??{},n),this.#r=e.tests?ts(e.tests,n):void 0,e.prep&&(this.#i=e.prep.bind(this),this.#e&&this.#e.next(this.prep(this.value))),e.name&&typeof e.name=="string"&&(this.#n=e.name),e.res&&e.res instanceof Map&&e.res.forEach((i,o)=>this.res.set(o,i))}#e;get subject(){return this.#e}$;get acts(){return this.$}debug;#i;prep(e){return this.#i?this.#i.call(this,e,this.value):e}res=new Map;#n;get name(){return this.#n||(this.#n="forestry-store:"+`${Math.random()}`.split(".").pop()),this.#n}complete(){if(!this.isActive)return this.value;const e=this.value;return this.isActive=!1,this.#e&&this.#e.complete(),e}isActive=!0;next(e){if(!this.isActive)throw new Error("Cannot update completed store");if(!this.subject)throw new Error("Store requires subject -- or override of next()");const r=this.prep(e),{isValid:n,error:i}=this.validate(r);if(n){this.#s()?this.queuePendingValue(r):this.#e.next(r);return}throw this.debug&&this.broadcast({action:"next-error",error:i,value:r}),X(i)}#o(e,r){const n=e.call(this,r,this);if(n)throw X(n)}get suspendValidation(){return this.#t.value.some(e=>e.suspendValidation)}transact(e,r){if(typeof e=="function"){this.transact({action:e,suspendValidation:!!r});return}const{action:n,suspendValidation:i}=e;let o="";try{let s=function(a){return n.call(c,a)};o=this.#f(i);const c=this;s(this.value),this.#a(o)}catch(s){throw o&&this.#l(o),s}}#t=new de([]);observeTransStack(e){return this.#t.subscribe(e)}#a(e){let r=!1;const n=this.#t.value.map(i=>i.id===e?(r=!0,{...i,isTransaction:!1,suspendValidation:!1}):i);r&&this.#t.next(n),this.#u()}#u(){if(!this.#t.value.some(e=>e.isTransaction)){const e=this.#t.value.pop();this.#t.next([]),e&&(this.broadcast({action:"checkTransComplete",phase:"next",value:e.value}),this.next(e.value))}}queuePendingValue(e){const r=`${Math.random()}`.replace("0.",""),n=`level_${this.#t.value.length}-${r}-trans`,i=[...this.#t.value,{id:n,value:e,isTransaction:!1}];return this.#t.next(i),n}#s(){return this.#t.value.some(e=>e.isTransaction)}#c=()=>{if(this.#s())return;const e=this.#t.value.pop();return this.#t.next([]),e};dequeuePendingValue(e){if(this.#t.value.findIndex(n=>n.id===e)===this.#t.value.length-1&&!this.#t.value.some(n=>n.isTransaction))return this.#c()}#f(e=!1){const r=`${Math.random()}`.replace("0.",""),n=`level_${this.#t.value.length}-${r}-trans`,i=[...this.#t.value,{id:n,value:this.value,suspendValidation:e,isTransaction:!0}];return this.#t.next(i),n}#l(e){const r=this.#t.value.findIndex(n=>n.id===e);if(r>=0){const n=this.#t.value.slice(0,r);this.#t.next(n)}}get root(){return this}get isRoot(){return!0}parent;broadcast(e,r){(r||!this.parent)&&this.receiver.next(e),this.root&&this.root!==this&&this.root.broadcast(e)}receiver=new wt;validate(e){if(this.suspendValidation)return{isValid:!0};if(Lo(this.schema))try{this.schema.parse(e)}catch(r){return{isValid:!1,error:X(r),source:"schema"}}return this.test(e)}isValid(e){return this.validate(e).isValid}schema;#r;test(e){let r;if(this.#r)try{if(Array.isArray(this.#r))for(const n of this.#r)r=n,this.#o(n,e);else typeof this.#r=="function"&&(r=this.#r,this.#o(this.#r,e))}catch(n){return{isValid:!1,value:e,error:X(n),testFn:r}}return{isValid:!0}}get value(){const e=this.#t.value;if(e.length)return e[e.length-1].value;if(!this.#e)throw new Error("Store requires subject or overload of value");return this.#e.value}subscribe(e){return this.subject.pipe(vr(cr)).subscribe(e)}get(e){if(!e||Array.isArray(e)&&e.length===0)return this.value;const r=Array.isArray(e)?e:I(e).split(".");return it(this.value,r)}set(e,r){const n=J(this.value,i=>{Ot(i,e,r)});this.next(n)}mutate(e,r){if(!r||Array.isArray(r)&&r.length===0){const n=J(this.value,e);return this.next(n),this.value}else{const n=Array.isArray(r)?r:I(r).split("."),i=J(this.value,o=>{const s=it(o,n);s!==void 0&&e(s)});return this.next(i),this.value}}}class ae extends br{constructor(e,r,n){if(!Bo(n))throw new Error("ForestBranches must have parents");const i=it(n.value,r);super({...e,value:i},!0),this.path=r,this.parent=n,this.#e=n.receiver.subscribe(o=>{this.handleMessage(o)})}#e;handleMessage(e){if(e&&typeof e=="object"&&e.type)switch(e.type){case"validate-all":this.validateAndReport();break;case"complete":this.complete();break}this.broadcast(e,!0)}get value(){return it(this.parent?.value,this.path)}validateAndReport(){const{isValid:e,error:r}=this.validate(this.value);if(!e){const n={type:"validation-failure",branchPath:this.path,error:typeof r=="string"?r:r?.toString()||"Unknown validation error",timestamp:Date.now()};this.root.broadcast(n)}}get root(){let e=this.parent;for(;!e.isRoot&&e.parent;)e=e.parent;return e}get isRoot(){return!this.parent}next(e){if(!this.isActive)throw new Error("Cannot update completed store");const r=this.prep?this.prep(e,this.value):e,{isValid:n,error:i}=this.validate(r);if(!n)throw i;this.parent?this.parent.set(this.path,r):super.next(r)}get subject(){const e=I(this.path);return this.parent.subject.pipe(zr(r=>Ni(r,e)),vr(cr))}subscribe(e){return this.subject.subscribe(e)}set(e,r){if(this.parent){const n=gt(this.path,e);return this.parent.set(n,r)}else{const n=Array.isArray(e)?e:I(e).split("."),i=J(this.value,o=>{Ot(o,n,r)});return this.next(i)}}receiver=new wt;broadcast(e,r){r||this.isRoot?this.receiver.next(e):this.root&&this.root!==this?this.root.broadcast(e):console.warn("strange broadcast pattern; node that is not root has no parent")}branch(e,r){const n=gt(this.path,e),i=this.name+"."+I(e);return new ae({name:i,...r},n,this)}complete(){if(!this.isActive)return this.value;const e={type:"complete",timestamp:Date.now()};this.broadcast(e,!0);const r=super.complete();return this.receiver.complete(),this.#e.unsubscribe(),r}destroy(){this.#e.unsubscribe()}}class ys extends br{constructor(e){super(e)}path=[];parent=null;isRoot=!0;get root(){return this}complete(){if(!this.isActive)return this.value;const e={type:"complete",timestamp:Date.now()};return this.broadcast(e,!0),this.receiver.complete(),super.complete()}next(e){const r=this.prep?this.prep(e,this.value):e,{isValid:n,error:i}=this.validate(r);if(!n)throw this.debug&&console.error(`cannot update ${this.name} with `,r,i),X(i);const o=this.queuePendingValue(r);try{this.#e(r),this.dequeuePendingValue(o)&&super.next(r)}catch(s){throw this.dequeuePendingValue(o),s}}#e(e){let r=null;const n=this.receiver.subscribe(i=>{i&&i.type==="validation-failure"&&(r=`Branch ${I(i.branchPath)}: ${i.error}`)});try{const i={type:"set-pending",payload:e,timestamp:Date.now()};this.broadcast(i,!0);const o={type:"validate-all",timestamp:Date.now()};if(this.broadcast(o,!0),r)throw this.debug&&console.error("Branch validation failed:",r),new Error(`Validation failed: ${r}`)}finally{n.unsubscribe()}}set(e,r){const n=Array.isArray(e)?e:I(e).split("."),i=J(this.value,o=>{Ot(o,n,r)});return this.next(i)}branch(e,r){const n=this.name+"."+I(e);return new ae({name:n,...r},e,this)}}export{ys as F,br as S};
