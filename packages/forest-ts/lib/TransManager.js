"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class TransHandler{constructor(s,t,e){this.mgr=s,this.id=t,this.props=e,this.puts=[];const r=this;this._sub=s.tree.updates.subscribe({next(t){"put-data"===t.action&&t.collection&&(s.tree.has(t.collection,t.identity)?r.puts.push(Object.assign(Object.assign({},t),{prev:s.tree.get(t.collection,t.identity)})):r.puts.push(t))}})}complete(){this.mgr.remove(this.id,!0),this._sub.unsubscribe()}fail(){this.mgr.remove(this.id,!1),this._sub.unsubscribe()}}class TransManager{constructor(t){this.tree=t,this.pendingHandlers=[],this.nextHandlerId=1}start(t){t=new TransHandler(this,this.nextHandlerId,t);return this.nextHandlerId+=1,this.pendingHandlers.push(t),t}remove(s,t){const e=[],r=[];this.pendingHandlers.forEach(t=>{(t.id>=s?r:e).push(t)}),!t&&e.length&&this.tree.revert(r)}}exports.default=TransManager;