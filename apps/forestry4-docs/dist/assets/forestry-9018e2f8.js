var Zr=Object.defineProperty;var Jr=(t,e,r)=>e in t?Zr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var P=(t,e,r)=>(Jr(t,typeof e!="symbol"?e+"":e,r),r),Xt=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var l=(t,e,r)=>(Xt(t,e,"read from private field"),r?r.call(t):e.get(t)),A=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},N=(t,e,r,n)=>(Xt(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var $=(t,e,r)=>(Xt(t,e,"access private method"),r);var ie=function(t,e){return ie=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},ie(t,e)};function rt(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ie(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function oe(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ot(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function xt(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function C(t){return typeof t=="function"}function gr(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var Zt=gr(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function se(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Bt=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var u=oe(s),a=u.next();!a.done;a=u.next()){var c=a.value;c.remove(this)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(C(f))try{f()}catch(h){o=h instanceof Zt?h.errors:[h]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var p=oe(y),_=p.next();!_.done;_=p.next()){var w=_.value;try{ze(w)}catch(h){o=o??[],h instanceof Zt?o=xt(xt([],Ot(o)),Ot(h.errors)):o.push(h)}}}catch(h){n={error:h}}finally{try{_&&!_.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new Zt(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)ze(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&se(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&se(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),mr=Bt.EMPTY;function wr(t){return t instanceof Bt||t&&"closed"in t&&C(t.remove)&&C(t.add)&&C(t.unsubscribe)}function ze(t){C(t)?t():t.unsubscribe()}var Sr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ae={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=ae.delegate;return i!=null&&i.setTimeout?i.setTimeout.apply(i,xt([t,e],Ot(r))):setTimeout.apply(void 0,xt([t,e],Ot(r)))},clearTimeout:function(t){var e=ae.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Qr(t){ae.setTimeout(function(){throw t})}function Fe(){}function Tt(t){t()}var Te=function(t){rt(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,wr(r)&&r.add(n)):n.destination=rn,n}return e.create=function(r,n,i){return new ue(r,n,i)},e.prototype.next=function(r){this.isStopped||this._next(r)},e.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Bt),kr=Function.prototype.bind;function Jt(t,e){return kr.call(t,e)}var tn=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){wt(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){wt(n)}else wt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){wt(r)}},t}(),ue=function(t){rt(e,t);function e(r,n,i){var o=t.call(this)||this,s;if(C(r)||!r)s={next:r??void 0,error:n??void 0,complete:i??void 0};else{var u;o&&Sr.useDeprecatedNextContext?(u=Object.create(r),u.unsubscribe=function(){return o.unsubscribe()},s={next:r.next&&Jt(r.next,u),error:r.error&&Jt(r.error,u),complete:r.complete&&Jt(r.complete,u)}):s=r}return o.destination=new tn(s),o}return e}(Te);function wt(t){Qr(t)}function en(t){throw t}var rn={closed:!0,next:Fe,error:en,complete:Fe},nn=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function on(t){return t}function sn(t){return t.length===0?on:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var De=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,o=un(e)?e:new ue(e,r,n);return Tt(function(){var s=i,u=s.operator,a=s.source;o.add(u?u.call(o,a):a?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=Re(r),new r(function(i,o){var s=new ue({next:function(u){try{e(u)}catch(a){o(a),s.unsubscribe()}},error:o,complete:i});n.subscribe(s)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[nn]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return sn(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=Re(e),new e(function(n,i){var o;r.subscribe(function(s){return o=s},function(s){return i(s)},function(){return n(o)})})},t.create=function(e){return new t(e)},t}();function Re(t){var e;return(e=t??Sr.Promise)!==null&&e!==void 0?e:Promise}function an(t){return t&&C(t.next)&&C(t.error)&&C(t.complete)}function un(t){return t&&t instanceof Te||an(t)&&wr(t)}function cn(t){return C(t==null?void 0:t.lift)}function fn(t){return function(e){if(cn(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ln(t,e,r,n,i){return new hn(t,e,r,n,i)}var hn=function(t){rt(e,t);function e(r,n,i,o,s,u){var a=t.call(this,r)||this;return a.onFinalize=s,a.shouldUnsubscribe=u,a._next=n?function(c){try{n(c)}catch(f){r.error(f)}}:t.prototype._next,a._error=o?function(c){try{o(c)}catch(f){r.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(c){r.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(Te),pn=gr(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Gt=function(t){rt(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.currentObservers=null,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new Ue(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new pn},e.prototype.next=function(r){var n=this;Tt(function(){var i,o;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var s=oe(n.currentObservers),u=s.next();!u.done;u=s.next()){var a=u.value;a.next(r)}}catch(c){i={error:c}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}})},e.prototype.error=function(r){var n=this;Tt(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},e.prototype.complete=function(){var r=this;Tt(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,i=this,o=i.hasError,s=i.isStopped,u=i.observers;return o||s?mr:(this.currentObservers=null,u.push(r),new Bt(function(){n.currentObservers=null,se(u,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,o=n.thrownError,s=n.isStopped;i?r.error(o):s&&r.complete()},e.prototype.asObservable=function(){var r=new De;return r.source=this,r},e.create=function(r,n){return new Ue(r,n)},e}(De),Ue=function(t){rt(e,t);function e(r,n){var i=t.call(this)||this;return i.destination=r,i.source=n,i}return e.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},e.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:mr},e}(Gt),Ve=function(t){rt(e,t);function e(r){var n=t.call(this)||this;return n._value=r,n}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(r){var n=t.prototype._subscribe.call(this,r);return!n.closed&&r.next(this._value),n},e.prototype.getValue=function(){var r=this,n=r.hasError,i=r.thrownError,o=r._value;if(n)throw i;return this._throwIfClosed(),o},e.prototype.next=function(r){t.prototype.next.call(this,this._value=r)},e}(Gt);function dn(t,e){return fn(function(r,n){var i=0;r.subscribe(ln(n,function(o){n.next(t.call(e,o,i++))}))})}var yn=typeof global=="object"&&global&&global.Object===Object&&global;const Ar=yn;var vn=typeof self=="object"&&self&&self.Object===Object&&self,bn=Ar||vn||Function("return this")();const z=bn;var _n=z.Symbol;const L=_n;var Pr=Object.prototype,gn=Pr.hasOwnProperty,mn=Pr.toString,ot=L?L.toStringTag:void 0;function wn(t){var e=gn.call(t,ot),r=t[ot];try{t[ot]=void 0;var n=!0}catch{}var i=mn.call(t);return n&&(e?t[ot]=r:delete t[ot]),i}var Sn=Object.prototype,An=Sn.toString;function Pn(t){return An.call(t)}var Tn="[object Null]",En="[object Undefined]",Le=L?L.toStringTag:void 0;function nt(t){return t==null?t===void 0?En:Tn:Le&&Le in Object(t)?wn(t):Pn(t)}function k(t){return t!=null&&typeof t=="object"}var On="[object Symbol]";function Ee(t){return typeof t=="symbol"||k(t)&&nt(t)==On}function xn(t,e){for(var r=-1,n=t==null?0:t.length,i=Array(n);++r<n;)i[r]=e(t[r],r,t);return i}var $n=Array.isArray;const Y=$n;var jn=1/0,Be=L?L.prototype:void 0,Ge=Be?Be.toString:void 0;function Tr(t){if(typeof t=="string")return t;if(Y(t))return xn(t,Tr)+"";if(Ee(t))return Ge?Ge.call(t):"";var e=t+"";return e=="0"&&1/t==-jn?"-0":e}function Er(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Cn="[object AsyncFunction]",In="[object Function]",Mn="[object GeneratorFunction]",zn="[object Proxy]";function Or(t){if(!Er(t))return!1;var e=nt(t);return e==In||e==Mn||e==Cn||e==zn}var Fn=z["__core-js_shared__"];const Qt=Fn;var Ne=function(){var t=/[^.]+$/.exec(Qt&&Qt.keys&&Qt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Dn(t){return!!Ne&&Ne in t}var Rn=Function.prototype,Un=Rn.toString;function Z(t){if(t!=null){try{return Un.call(t)}catch{}try{return t+""}catch{}}return""}var Vn=/[\\^$.*+?()[\]{}|]/g,Ln=/^\[object .+?Constructor\]$/,Bn=Function.prototype,Gn=Object.prototype,Nn=Bn.toString,Hn=Gn.hasOwnProperty,Kn=RegExp("^"+Nn.call(Hn).replace(Vn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qn(t){if(!Er(t)||Dn(t))return!1;var e=Or(t)?Kn:Ln;return e.test(Z(t))}function Yn(t,e){return t==null?void 0:t[e]}function it(t,e){var r=Yn(t,e);return qn(r)?r:void 0}var Wn=it(z,"WeakMap");const ce=Wn;var Xn=9007199254740991,Zn=/^(?:0|[1-9]\d*)$/;function Jn(t,e){var r=typeof t;return e=e??Xn,!!e&&(r=="number"||r!="symbol"&&Zn.test(t))&&t>-1&&t%1==0&&t<e}function xr(t,e){return t===e||t!==t&&e!==e}var Qn=9007199254740991;function $r(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Qn}function kn(t){return t!=null&&$r(t.length)&&!Or(t)}var ti=Object.prototype;function ei(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||ti;return t===r}function ri(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}var ni="[object Arguments]";function He(t){return k(t)&&nt(t)==ni}var jr=Object.prototype,ii=jr.hasOwnProperty,oi=jr.propertyIsEnumerable,si=He(function(){return arguments}())?He:function(t){return k(t)&&ii.call(t,"callee")&&!oi.call(t,"callee")};const ai=si;function ui(){return!1}var Cr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Ke=Cr&&typeof module=="object"&&module&&!module.nodeType&&module,ci=Ke&&Ke.exports===Cr,qe=ci?z.Buffer:void 0,fi=qe?qe.isBuffer:void 0,li=fi||ui;const fe=li;var hi="[object Arguments]",pi="[object Array]",di="[object Boolean]",yi="[object Date]",vi="[object Error]",bi="[object Function]",_i="[object Map]",gi="[object Number]",mi="[object Object]",wi="[object RegExp]",Si="[object Set]",Ai="[object String]",Pi="[object WeakMap]",Ti="[object ArrayBuffer]",Ei="[object DataView]",Oi="[object Float32Array]",xi="[object Float64Array]",$i="[object Int8Array]",ji="[object Int16Array]",Ci="[object Int32Array]",Ii="[object Uint8Array]",Mi="[object Uint8ClampedArray]",zi="[object Uint16Array]",Fi="[object Uint32Array]",b={};b[Oi]=b[xi]=b[$i]=b[ji]=b[Ci]=b[Ii]=b[Mi]=b[zi]=b[Fi]=!0;b[hi]=b[pi]=b[Ti]=b[di]=b[Ei]=b[yi]=b[vi]=b[bi]=b[_i]=b[gi]=b[mi]=b[wi]=b[Si]=b[Ai]=b[Pi]=!1;function Di(t){return k(t)&&$r(t.length)&&!!b[nt(t)]}function Ri(t){return function(e){return t(e)}}var Ir=typeof exports=="object"&&exports&&!exports.nodeType&&exports,at=Ir&&typeof module=="object"&&module&&!module.nodeType&&module,Ui=at&&at.exports===Ir,kt=Ui&&Ar.process,Vi=function(){try{var t=at&&at.require&&at.require("util").types;return t||kt&&kt.binding&&kt.binding("util")}catch{}}();const Ye=Vi;var We=Ye&&Ye.isTypedArray,Li=We?Ri(We):Di;const Mr=Li;var Bi=Object.prototype,Gi=Bi.hasOwnProperty;function Ni(t,e){var r=Y(t),n=!r&&ai(t),i=!r&&!n&&fe(t),o=!r&&!n&&!i&&Mr(t),s=r||n||i||o,u=s?ri(t.length,String):[],a=u.length;for(var c in t)(e||Gi.call(t,c))&&!(s&&(c=="length"||i&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Jn(c,a)))&&u.push(c);return u}function Hi(t,e){return function(r){return t(e(r))}}var Ki=Hi(Object.keys,Object);const qi=Ki;var Yi=Object.prototype,Wi=Yi.hasOwnProperty;function Xi(t){if(!ei(t))return qi(t);var e=[];for(var r in Object(t))Wi.call(t,r)&&r!="constructor"&&e.push(r);return e}function Zi(t){return kn(t)?Ni(t):Xi(t)}var Ji=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Qi=/^\w*$/;function ki(t,e){if(Y(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||Ee(t)?!0:Qi.test(t)||!Ji.test(t)||e!=null&&t in Object(e)}var to=it(Object,"create");const ct=to;function eo(){this.__data__=ct?ct(null):{},this.size=0}function ro(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var no="__lodash_hash_undefined__",io=Object.prototype,oo=io.hasOwnProperty;function so(t){var e=this.__data__;if(ct){var r=e[t];return r===no?void 0:r}return oo.call(e,t)?e[t]:void 0}var ao=Object.prototype,uo=ao.hasOwnProperty;function co(t){var e=this.__data__;return ct?e[t]!==void 0:uo.call(e,t)}var fo="__lodash_hash_undefined__";function lo(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ct&&e===void 0?fo:e,this}function W(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}W.prototype.clear=eo;W.prototype.delete=ro;W.prototype.get=so;W.prototype.has=co;W.prototype.set=lo;function ho(){this.__data__=[],this.size=0}function Nt(t,e){for(var r=t.length;r--;)if(xr(t[r][0],e))return r;return-1}var po=Array.prototype,yo=po.splice;function vo(t){var e=this.__data__,r=Nt(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():yo.call(e,r,1),--this.size,!0}function bo(t){var e=this.__data__,r=Nt(e,t);return r<0?void 0:e[r][1]}function _o(t){return Nt(this.__data__,t)>-1}function go(t,e){var r=this.__data__,n=Nt(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function F(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}F.prototype.clear=ho;F.prototype.delete=vo;F.prototype.get=bo;F.prototype.has=_o;F.prototype.set=go;var mo=it(z,"Map");const ft=mo;function wo(){this.size=0,this.__data__={hash:new W,map:new(ft||F),string:new W}}function So(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Ht(t,e){var r=t.__data__;return So(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Ao(t){var e=Ht(this,t).delete(t);return this.size-=e?1:0,e}function Po(t){return Ht(this,t).get(t)}function To(t){return Ht(this,t).has(t)}function Eo(t,e){var r=Ht(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function D(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}D.prototype.clear=wo;D.prototype.delete=Ao;D.prototype.get=Po;D.prototype.has=To;D.prototype.set=Eo;var Oo="Expected a function";function Oe(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Oo);var r=function(){var n=arguments,i=e?e.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var s=t.apply(this,n);return r.cache=o.set(i,s)||o,s};return r.cache=new(Oe.Cache||D),r}Oe.Cache=D;var xo=500;function $o(t){var e=Oe(t,function(n){return r.size===xo&&r.clear(),n}),r=e.cache;return e}var jo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Co=/\\(\\)?/g,Io=$o(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(jo,function(r,n,i,o){e.push(i?o.replace(Co,"$1"):n||r)}),e});const Mo=Io;function zo(t){return t==null?"":Tr(t)}function Fo(t,e){return Y(t)?t:ki(t,e)?[t]:Mo(zo(t))}var Do=1/0;function Ro(t){if(typeof t=="string"||Ee(t))return t;var e=t+"";return e=="0"&&1/t==-Do?"-0":e}function Uo(t,e){e=Fo(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[Ro(e[r++])];return r&&r==n?t:void 0}function Vo(t,e,r){var n=t==null?void 0:Uo(t,e);return n===void 0?r:n}function Lo(t,e){for(var r=-1,n=e.length,i=t.length;++r<n;)t[i+r]=e[r];return t}function Bo(){this.__data__=new F,this.size=0}function Go(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function No(t){return this.__data__.get(t)}function Ho(t){return this.__data__.has(t)}var Ko=200;function qo(t,e){var r=this.__data__;if(r instanceof F){var n=r.__data__;if(!ft||n.length<Ko-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new D(n)}return r.set(t,e),this.size=r.size,this}function U(t){var e=this.__data__=new F(t);this.size=e.size}U.prototype.clear=Bo;U.prototype.delete=Go;U.prototype.get=No;U.prototype.has=Ho;U.prototype.set=qo;function Yo(t,e){for(var r=-1,n=t==null?0:t.length,i=0,o=[];++r<n;){var s=t[r];e(s,r,t)&&(o[i++]=s)}return o}function Wo(){return[]}var Xo=Object.prototype,Zo=Xo.propertyIsEnumerable,Xe=Object.getOwnPropertySymbols,Jo=Xe?function(t){return t==null?[]:(t=Object(t),Yo(Xe(t),function(e){return Zo.call(t,e)}))}:Wo;const Qo=Jo;function ko(t,e,r){var n=e(t);return Y(t)?n:Lo(n,r(t))}function Ze(t){return ko(t,Zi,Qo)}var ts=it(z,"DataView");const le=ts;var es=it(z,"Promise");const he=es;var rs=it(z,"Set");const pe=rs;var Je="[object Map]",ns="[object Object]",Qe="[object Promise]",ke="[object Set]",tr="[object WeakMap]",er="[object DataView]",is=Z(le),os=Z(ft),ss=Z(he),as=Z(pe),us=Z(ce),H=nt;(le&&H(new le(new ArrayBuffer(1)))!=er||ft&&H(new ft)!=Je||he&&H(he.resolve())!=Qe||pe&&H(new pe)!=ke||ce&&H(new ce)!=tr)&&(H=function(t){var e=nt(t),r=e==ns?t.constructor:void 0,n=r?Z(r):"";if(n)switch(n){case is:return er;case os:return Je;case ss:return Qe;case as:return ke;case us:return tr}return e});const rr=H;var cs=z.Uint8Array;const nr=cs;var fs="__lodash_hash_undefined__";function ls(t){return this.__data__.set(t,fs),this}function hs(t){return this.__data__.has(t)}function $t(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new D;++e<r;)this.add(t[e])}$t.prototype.add=$t.prototype.push=ls;$t.prototype.has=hs;function ps(t,e){for(var r=-1,n=t==null?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1}function ds(t,e){return t.has(e)}var ys=1,vs=2;function zr(t,e,r,n,i,o){var s=r&ys,u=t.length,a=e.length;if(u!=a&&!(s&&a>u))return!1;var c=o.get(t),f=o.get(e);if(c&&f)return c==e&&f==t;var y=-1,p=!0,_=r&vs?new $t:void 0;for(o.set(t,e),o.set(e,t);++y<u;){var w=t[y],h=e[y];if(n)var R=s?n(h,w,y,e,t,o):n(w,h,y,t,e,o);if(R!==void 0){if(R)continue;p=!1;break}if(_){if(!ps(e,function(B,G){if(!ds(_,G)&&(w===B||i(w,B,r,n,o)))return _.push(G)})){p=!1;break}}else if(!(w===h||i(w,h,r,n,o))){p=!1;break}}return o.delete(t),o.delete(e),p}function bs(t){var e=-1,r=Array(t.size);return t.forEach(function(n,i){r[++e]=[i,n]}),r}function _s(t){var e=-1,r=Array(t.size);return t.forEach(function(n){r[++e]=n}),r}var gs=1,ms=2,ws="[object Boolean]",Ss="[object Date]",As="[object Error]",Ps="[object Map]",Ts="[object Number]",Es="[object RegExp]",Os="[object Set]",xs="[object String]",$s="[object Symbol]",js="[object ArrayBuffer]",Cs="[object DataView]",ir=L?L.prototype:void 0,te=ir?ir.valueOf:void 0;function Is(t,e,r,n,i,o,s){switch(r){case Cs:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case js:return!(t.byteLength!=e.byteLength||!o(new nr(t),new nr(e)));case ws:case Ss:case Ts:return xr(+t,+e);case As:return t.name==e.name&&t.message==e.message;case Es:case xs:return t==e+"";case Ps:var u=bs;case Os:var a=n&gs;if(u||(u=_s),t.size!=e.size&&!a)return!1;var c=s.get(t);if(c)return c==e;n|=ms,s.set(t,e);var f=zr(u(t),u(e),n,i,o,s);return s.delete(t),f;case $s:if(te)return te.call(t)==te.call(e)}return!1}var Ms=1,zs=Object.prototype,Fs=zs.hasOwnProperty;function Ds(t,e,r,n,i,o){var s=r&Ms,u=Ze(t),a=u.length,c=Ze(e),f=c.length;if(a!=f&&!s)return!1;for(var y=a;y--;){var p=u[y];if(!(s?p in e:Fs.call(e,p)))return!1}var _=o.get(t),w=o.get(e);if(_&&w)return _==e&&w==t;var h=!0;o.set(t,e),o.set(e,t);for(var R=s;++y<a;){p=u[y];var B=t[p],G=e[p];if(n)var Me=s?n(G,B,p,e,t,o):n(B,G,p,t,e,o);if(!(Me===void 0?B===G||i(B,G,r,n,o):Me)){h=!1;break}R||(R=p=="constructor")}if(h&&!R){var gt=t.constructor,mt=e.constructor;gt!=mt&&"constructor"in t&&"constructor"in e&&!(typeof gt=="function"&&gt instanceof gt&&typeof mt=="function"&&mt instanceof mt)&&(h=!1)}return o.delete(t),o.delete(e),h}var Rs=1,or="[object Arguments]",sr="[object Array]",St="[object Object]",Us=Object.prototype,ar=Us.hasOwnProperty;function Vs(t,e,r,n,i,o){var s=Y(t),u=Y(e),a=s?sr:rr(t),c=u?sr:rr(e);a=a==or?St:a,c=c==or?St:c;var f=a==St,y=c==St,p=a==c;if(p&&fe(t)){if(!fe(e))return!1;s=!0,f=!1}if(p&&!f)return o||(o=new U),s||Mr(t)?zr(t,e,r,n,i,o):Is(t,e,a,r,n,i,o);if(!(r&Rs)){var _=f&&ar.call(t,"__wrapped__"),w=y&&ar.call(e,"__wrapped__");if(_||w){var h=_?t.value():t,R=w?e.value():e;return o||(o=new U),i(h,R,r,n,o)}}return p?(o||(o=new U),Ds(t,e,r,n,i,o)):!1}function Fr(t,e,r,n,i){return t===e?!0:t==null||e==null||!k(t)&&!k(e)?t!==t&&e!==e:Vs(t,e,r,n,Fr,i)}function Dr(t,e){return Fr(t,e)}function st(t){return t instanceof Error?t:t?typeof t=="string"?new Error(t):new Error("unknown / bad error in Forestry"):new Error("(unknown error in Forestry (maybe a validation test?)")}function Et(t){return typeof t=="object"&&t!==null}function Ls(t){return Et(t)&&typeof t.parse=="function"}function Bs(t){return Et(t)&&"value"in t&&typeof t.next=="function"&&Et(t==null?void 0:t.acts)&&Et(t==null?void 0:t.$)}var Rr=Symbol.for("immer-nothing"),ur=Symbol.for("immer-draftable"),d=Symbol.for("immer-state");function x(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var tt=Object.getPrototypeOf;function et(t){return!!t&&!!t[d]}function M(t){var e;return t?Ur(t)||Array.isArray(t)||!!t[ur]||!!((e=t.constructor)!=null&&e[ur])||_t(t)||qt(t):!1}var Gs=Object.prototype.constructor.toString();function Ur(t){if(!t||typeof t!="object")return!1;const e=tt(t);if(e===null)return!0;const r=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return r===Object?!0:typeof r=="function"&&Function.toString.call(r)===Gs}function lt(t,e){Kt(t)===0?Reflect.ownKeys(t).forEach(r=>{e(r,t[r],t)}):t.forEach((r,n)=>e(n,r,t))}function Kt(t){const e=t[d];return e?e.type_:Array.isArray(t)?1:_t(t)?2:qt(t)?3:0}function de(t,e){return Kt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Vr(t,e,r){const n=Kt(t);n===2?t.set(e,r):n===3?t.add(r):t[e]=r}function Ns(t,e){return t===e?t!==0||1/t===1/e:t!==t&&e!==e}function _t(t){return t instanceof Map}function qt(t){return t instanceof Set}function m(t){return t.copy_||t.base_}function ye(t,e){if(_t(t))return new Map(t);if(qt(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const r=Ur(t);if(e===!0||e==="class_only"&&!r){const n=Object.getOwnPropertyDescriptors(t);delete n[d];let i=Reflect.ownKeys(n);for(let o=0;o<i.length;o++){const s=i[o],u=n[s];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(n[s]={configurable:!0,writable:!0,enumerable:u.enumerable,value:t[s]})}return Object.create(tt(t),n)}else{const n=tt(t);if(n!==null&&r)return{...t};const i=Object.create(n);return Object.assign(i,t)}}function xe(t,e=!1){return Yt(t)||et(t)||!M(t)||(Kt(t)>1&&Object.defineProperties(t,{set:{value:At},add:{value:At},clear:{value:At},delete:{value:At}}),Object.freeze(t),e&&Object.values(t).forEach(r=>xe(r,!0))),t}function At(){x(2)}function Yt(t){return Object.isFrozen(t)}var ve={};function X(t){const e=ve[t];return e||x(0,t),e}function Hs(t,e){ve[t]||(ve[t]=e)}var ht;function jt(){return ht}function Ks(t,e){return{drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function cr(t,e){e&&(X("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e)}function be(t){_e(t),t.drafts_.forEach(qs),t.drafts_=null}function _e(t){t===ht&&(ht=t.parent_)}function fr(t){return ht=Ks(ht,t)}function qs(t){const e=t[d];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function lr(t,e){e.unfinalizedDrafts_=e.drafts_.length;const r=e.drafts_[0];return t!==void 0&&t!==r?(r[d].modified_&&(be(e),x(4)),M(t)&&(t=Ct(e,t),e.parent_||It(e,t)),e.patches_&&X("Patches").generateReplacementPatches_(r[d].base_,t,e.patches_,e.inversePatches_)):t=Ct(e,r,[]),be(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==Rr?t:void 0}function Ct(t,e,r){if(Yt(e))return e;const n=e[d];if(!n)return lt(e,(i,o)=>hr(t,n,e,i,o,r)),e;if(n.scope_!==t)return e;if(!n.modified_)return It(t,n.base_,!0),n.base_;if(!n.finalized_){n.finalized_=!0,n.scope_.unfinalizedDrafts_--;const i=n.copy_;let o=i,s=!1;n.type_===3&&(o=new Set(i),i.clear(),s=!0),lt(o,(u,a)=>hr(t,n,i,u,a,r,s)),It(t,i,!1),r&&t.patches_&&X("Patches").generatePatches_(n,r,t.patches_,t.inversePatches_)}return n.copy_}function hr(t,e,r,n,i,o,s){if(et(i)){const u=o&&e&&e.type_!==3&&!de(e.assigned_,n)?o.concat(n):void 0,a=Ct(t,i,u);if(Vr(r,n,a),et(a))t.canAutoFreeze_=!1;else return}else s&&r.add(i);if(M(i)&&!Yt(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;Ct(t,i),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&(_t(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))&&It(t,i)}}function It(t,e,r=!1){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&xe(e,r)}function Ys(t,e){const r=Array.isArray(t),n={type_:r?1:0,scope_:e?e.scope_:jt(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,o=$e;r&&(i=[n],o=pt);const{revoke:s,proxy:u}=Proxy.revocable(i,o);return n.draft_=u,n.revoke_=s,u}var $e={get(t,e){if(e===d)return t;const r=m(t);if(!de(r,e))return Ws(t,r,e);const n=r[e];return t.finalized_||!M(n)?n:n===ee(t.base_,e)?(re(t),t.copy_[e]=dt(n,t)):n},has(t,e){return e in m(t)},ownKeys(t){return Reflect.ownKeys(m(t))},set(t,e,r){const n=Lr(m(t),e);if(n!=null&&n.set)return n.set.call(t.draft_,r),!0;if(!t.modified_){const i=ee(m(t),e),o=i==null?void 0:i[d];if(o&&o.base_===r)return t.copy_[e]=r,t.assigned_[e]=!1,!0;if(Ns(r,i)&&(r!==void 0||de(t.base_,e)))return!0;re(t),I(t)}return t.copy_[e]===r&&(r!==void 0||e in t.copy_)||Number.isNaN(r)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=r,t.assigned_[e]=!0),!0},deleteProperty(t,e){return ee(t.base_,e)!==void 0||e in t.base_?(t.assigned_[e]=!1,re(t),I(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],!0},getOwnPropertyDescriptor(t,e){const r=m(t),n=Reflect.getOwnPropertyDescriptor(r,e);return n&&{writable:!0,configurable:t.type_!==1||e!=="length",enumerable:n.enumerable,value:r[e]}},defineProperty(){x(11)},getPrototypeOf(t){return tt(t.base_)},setPrototypeOf(){x(12)}},pt={};lt($e,(t,e)=>{pt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});pt.deleteProperty=function(t,e){return pt.set.call(this,t,e,void 0)};pt.set=function(t,e,r){return $e.set.call(this,t[0],e,r,t[0])};function ee(t,e){const r=t[d];return(r?m(r):t)[e]}function Ws(t,e,r){var i;const n=Lr(e,r);return n?"value"in n?n.value:(i=n.get)==null?void 0:i.call(t.draft_):void 0}function Lr(t,e){if(!(e in t))return;let r=tt(t);for(;r;){const n=Object.getOwnPropertyDescriptor(r,e);if(n)return n;r=tt(r)}}function I(t){t.modified_||(t.modified_=!0,t.parent_&&I(t.parent_))}function re(t){t.copy_||(t.copy_=ye(t.base_,t.scope_.immer_.useStrictShallowCopy_))}var Xs=class{constructor(t){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,r,n)=>{if(typeof e=="function"&&typeof r!="function"){const o=r;r=e;const s=this;return function(a=o,...c){return s.produce(a,f=>r.call(this,f,...c))}}typeof r!="function"&&x(6),n!==void 0&&typeof n!="function"&&x(7);let i;if(M(e)){const o=fr(this),s=dt(e,void 0);let u=!0;try{i=r(s),u=!1}finally{u?be(o):_e(o)}return cr(o,n),lr(i,o)}else if(!e||typeof e!="object"){if(i=r(e),i===void 0&&(i=e),i===Rr&&(i=void 0),this.autoFreeze_&&xe(i,!0),n){const o=[],s=[];X("Patches").generateReplacementPatches_(e,i,o,s),n(o,s)}return i}else x(1,e)},this.produceWithPatches=(e,r)=>{if(typeof e=="function")return(s,...u)=>this.produceWithPatches(s,a=>e(a,...u));let n,i;return[this.produce(e,r,(s,u)=>{n=s,i=u}),n,i]},typeof(t==null?void 0:t.autoFreeze)=="boolean"&&this.setAutoFreeze(t.autoFreeze),typeof(t==null?void 0:t.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(t.useStrictShallowCopy)}createDraft(t){M(t)||x(8),et(t)&&(t=Zs(t));const e=fr(this),r=dt(t,void 0);return r[d].isManual_=!0,_e(e),r}finishDraft(t,e){const r=t&&t[d];(!r||!r.isManual_)&&x(9);const{scope_:n}=r;return cr(n,e),lr(void 0,n)}setAutoFreeze(t){this.autoFreeze_=t}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t}applyPatches(t,e){let r;for(r=e.length-1;r>=0;r--){const i=e[r];if(i.path.length===0&&i.op==="replace"){t=i.value;break}}r>-1&&(e=e.slice(r+1));const n=X("Patches").applyPatches_;return et(t)?n(t,e):this.produce(t,i=>n(i,e))}};function dt(t,e){const r=_t(t)?X("MapSet").proxyMap_(t,e):qt(t)?X("MapSet").proxySet_(t,e):Ys(t,e);return(e?e.scope_:jt()).drafts_.push(r),r}function Zs(t){return et(t)||x(10,t),Br(t)}function Br(t){if(!M(t)||Yt(t))return t;const e=t[d];let r;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,r=ye(t,e.scope_.immer_.useStrictShallowCopy_)}else r=ye(t,!0);return lt(r,(n,i)=>{Vr(r,n,Br(i))}),e&&(e.finalized_=!1),r}function Js(){class t extends Map{constructor(a,c){super(),this[d]={type_:2,parent_:c,scope_:c?c.scope_:jt(),modified_:!1,finalized_:!1,copy_:void 0,assigned_:void 0,base_:a,draft_:this,isManual_:!1,revoked_:!1}}get size(){return m(this[d]).size}has(a){return m(this[d]).has(a)}set(a,c){const f=this[d];return s(f),(!m(f).has(a)||m(f).get(a)!==c)&&(r(f),I(f),f.assigned_.set(a,!0),f.copy_.set(a,c),f.assigned_.set(a,!0)),this}delete(a){if(!this.has(a))return!1;const c=this[d];return s(c),r(c),I(c),c.base_.has(a)?c.assigned_.set(a,!1):c.assigned_.delete(a),c.copy_.delete(a),!0}clear(){const a=this[d];s(a),m(a).size&&(r(a),I(a),a.assigned_=new Map,lt(a.base_,c=>{a.assigned_.set(c,!1)}),a.copy_.clear())}forEach(a,c){const f=this[d];m(f).forEach((y,p,_)=>{a.call(c,this.get(p),p,this)})}get(a){const c=this[d];s(c);const f=m(c).get(a);if(c.finalized_||!M(f)||f!==c.base_.get(a))return f;const y=dt(f,c);return r(c),c.copy_.set(a,y),y}keys(){return m(this[d]).keys()}values(){const a=this.keys();return{[Symbol.iterator]:()=>this.values(),next:()=>{const c=a.next();return c.done?c:{done:!1,value:this.get(c.value)}}}}entries(){const a=this.keys();return{[Symbol.iterator]:()=>this.entries(),next:()=>{const c=a.next();if(c.done)return c;const f=this.get(c.value);return{done:!1,value:[c.value,f]}}}}[Symbol.iterator](){return this.entries()}}function e(u,a){return new t(u,a)}function r(u){u.copy_||(u.assigned_=new Map,u.copy_=new Map(u.base_))}class n extends Set{constructor(a,c){super(),this[d]={type_:3,parent_:c,scope_:c?c.scope_:jt(),modified_:!1,finalized_:!1,copy_:void 0,base_:a,draft_:this,drafts_:new Map,revoked_:!1,isManual_:!1}}get size(){return m(this[d]).size}has(a){const c=this[d];return s(c),c.copy_?!!(c.copy_.has(a)||c.drafts_.has(a)&&c.copy_.has(c.drafts_.get(a))):c.base_.has(a)}add(a){const c=this[d];return s(c),this.has(a)||(o(c),I(c),c.copy_.add(a)),this}delete(a){if(!this.has(a))return!1;const c=this[d];return s(c),o(c),I(c),c.copy_.delete(a)||(c.drafts_.has(a)?c.copy_.delete(c.drafts_.get(a)):!1)}clear(){const a=this[d];s(a),m(a).size&&(o(a),I(a),a.copy_.clear())}values(){const a=this[d];return s(a),o(a),a.copy_.values()}entries(){const a=this[d];return s(a),o(a),a.copy_.entries()}keys(){return this.values()}[Symbol.iterator](){return this.values()}forEach(a,c){const f=this.values();let y=f.next();for(;!y.done;)a.call(c,y.value,y.value,this),y=f.next()}}function i(u,a){return new n(u,a)}function o(u){u.copy_||(u.copy_=new Set,u.base_.forEach(a=>{if(M(a)){const c=dt(a,u);u.drafts_.set(a,c),u.copy_.add(c)}else u.copy_.add(a)}))}function s(u){u.revoked_&&x(3,JSON.stringify(m(u)))}Hs("MapSet",{proxyMap_:e,proxySet_:i})}var Qs=new Xs,ut=Qs.produce;function ks(t,e){return Array.from(Object.keys(t)).reduce((r,n)=>{const i=t[n];return r[n]=function(...o){return i.call(e,e.value,...o)},r},{})}function ta(t,e){return Array.isArray(t)?t.map(r=>function(n){return r.call(e,n,e)}):function(r){return t.call(e,r,e)}}const S={scalar:"scalar",array:"array",map:"map",object:"object",set:"set",function:"function",container:"container",void:"void"},T={undefined:"undefined",object:"object",boolean:"boolean",number:"number",bigint:"bigint",string:"string",symbol:"symbol",function:"function"},g={string:"string",number:"number",boolean:"boolean",symbol:"symbol",array:"array",map:"map",object:"object",set:"set",null:"null",undefined:"undefined",function:"function"};class E{constructor(e,r,n,i){this.type=e,this.form=r,this.typeOf=n,this.test=i}get family(){return[S.scalar,S.void,S.function].includes(this.form)?this.form:S.container}includes(e,r){return r?!(r!==this.typeOf||this.test&&!this.test(e)):this.includes(e,typeof e)}}const pr=[new E(g.undefined,S.void,T.undefined),new E(g.null,S.void,T.object,t=>t===null),new E(g.boolean,S.scalar,T.boolean),new E(g.string,S.scalar,T.string),new E(g.number,S.scalar,T.number),new E(g.number,S.scalar,T.bigint),new E(g.symbol,S.scalar,T.symbol),new E(g.function,S.function,T.function),new E(g.array,S.array,T.object,t=>Array.isArray(t)),new E(g.map,S.map,T.object,t=>t instanceof Map),new E(g.set,S.set,T.object,t=>t instanceof Set),new E(g.object,S.object,T.object,t=>t&&typeof t=="object")],Mt=(t,e=!1)=>{if(e){const n=Mt(t);if(typeof n=="object"){if(e===!0)return n.type;if(e==="type"||e==="form"||e==="typeOf"||e==="family")return n[e]}return n}const r=typeof t;for(let n=0;n<pr.length;++n){const i=pr[n];if(i.includes(t,r))return i}throw console.error("describe failure to analyze",t),new Error("cannot analyze value")};function yt(t,e){return Array.isArray(e)?e.reduce((n,i)=>{if(n==null)return;switch(Mt(n,!0)){case g.map:return n.get(i);case g.array:{if(typeof i=="number")return n[i];const s=parseInt(i,10);return isNaN(s)?void 0:n[s]}case g.object:return n[i];default:return}},t):yt(t,e.split("."))}function Wt(t,e,r){if(!Array.isArray(e))return Wt(t,e.split("."),r);const[n]=e.slice(0,e.length-1).reduce(([s],u)=>{const a=Mt(s,!0);switch(a){case g.map:return s.has(u)||s.set(u,{}),[s.get(u)];case g.array:{if(typeof u=="number")return s[u];const c=parseInt(u,10);if(isNaN(c))throw new Error(`Invalid array index: ${u}`);return s[c]===void 0&&(s[c]={}),[s[c]]}case g.object:return(s[u]===void 0||s[u]===null)&&(s[u]={}),[s[u]];default:throw new Error(`Cannot set nested value on type: ${a}`)}},[t]),i=e[e.length-1],o=Mt(n,!0);switch(o){case g.map:n.set(i,r);break;case g.array:if(typeof i=="number")n[i]=r;else{const s=parseInt(i,10);if(isNaN(s))throw new Error(`Invalid array index: ${i}`);n[s]=r}break;case g.object:n[i]=r;break;default:throw new Error(`Cannot set value on type: ${o}`)}}function dr(t){if(Array.isArray(t))return t;if(typeof t=="string")return t.split(".");if(t instanceof RegExp)return[t];throw console.log("unparsable path: ",t),new Error("cannot parse path")}function V(t){return Array.isArray(t)?t.join("."):`${t}`}function zt(t,e){return Array.isArray(t)?Array.isArray(e)?t.length?e.length?[...t,...e]:t:e:zt(t,dr(e)):zt(dr(t),e)}function ea(t){return t}function q(t){return typeof t=="function"}function ra(t){return q(t==null?void 0:t.lift)}function na(t){return function(e){if(ra(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}var ge=function(t,e){return ge=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},ge(t,e)};function je(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ge(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function yr(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,o=[],s;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(u){s={error:u}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o}function we(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return t.concat(o||Array.prototype.slice.call(e))}function ia(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var ne=ia(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function vr(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var Ce=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,r,n,i,o;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var u=yr(s),a=u.next();!a.done;a=u.next()){var c=a.value;c.remove(this)}}catch(h){e={error:h}}finally{try{a&&!a.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}else s.remove(this);var f=this.initialTeardown;if(q(f))try{f()}catch(h){o=h instanceof ne?h.errors:[h]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var p=yr(y),_=p.next();!_.done;_=p.next()){var w=_.value;try{br(w)}catch(h){o=o??[],h instanceof ne?o=we(we([],me(o)),me(h.errors)):o.push(h)}}}catch(h){n={error:h}}finally{try{_&&!_.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}if(o)throw new ne(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)br(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(r=this._finalizers)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&vr(r,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&vr(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}();Ce.EMPTY;function oa(t){return t instanceof Ce||t&&"closed"in t&&q(t.remove)&&q(t.add)&&q(t.unsubscribe)}function br(t){q(t)?t():t.unsubscribe()}var sa={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];return setTimeout.apply(void 0,we([t,e],me(r)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function aa(t){sa.setTimeout(function(){throw t})}function _r(){}var Gr=function(t){je(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,oa(r)&&r.add(n)):n.destination=la,n}return e.create=function(r,n,i){return new ca(r,n,i)},e.prototype.next=function(r){this.isStopped||this._next(r)},e.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Ce),ua=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){Pt(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){Pt(n)}else Pt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){Pt(r)}},t}(),ca=function(t){je(e,t);function e(r,n,i){var o=t.call(this)||this,s;return q(r)||!r?s={next:r??void 0,error:n??void 0,complete:i??void 0}:s=r,o.destination=new ua(s),o}return e}(Gr);function Pt(t){aa(t)}function fa(t){throw t}var la={closed:!0,next:_r,error:fa,complete:_r};function ha(t,e,r,n,i){return new pa(t,e,r,n,i)}var pa=function(t){je(e,t);function e(r,n,i,o,s,u){var a=t.call(this,r)||this;return a.onFinalize=s,a.shouldUnsubscribe=u,a._next=n?function(c){try{n(c)}catch(f){r.error(f)}}:t.prototype._next,a._error=o?function(c){try{o(c)}catch(f){r.error(f)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(c){r.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,a}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(Gr);function Nr(t,e){return e===void 0&&(e=ea),t=t??da,na(function(r,n){var i,o=!0;r.subscribe(ha(n,function(s){var u=e(s);(o||!t(i,u))&&(o=!1,i=u,n.next(s))}))})}function da(t,e){return t===e}Js();var O,J,K,vt,Se,v,Ft,Kr,Dt,qr,bt,Ae,Rt,Ut,Yr,Vt,Wr,j;class Hr{constructor(e,r=!1){A(this,vt);A(this,Ft);A(this,Dt);A(this,bt);A(this,Ut);A(this,Vt);A(this,O,void 0);P(this,"$");P(this,"debug");A(this,J,void 0);P(this,"res",new Map);A(this,K,void 0);P(this,"isActive",!0);A(this,v,new Ve([]));A(this,Rt,()=>{if($(this,bt,Ae).call(this))return;const e=l(this,v).value.pop();return l(this,v).next([]),e});P(this,"parent");P(this,"receiver",new Gt);P(this,"schema");A(this,j,void 0);r||N(this,O,new Ve(e.value)),"schema"in e&&e.schema&&(this.schema=e.schema),this.debug=!!e.debug;const n=this;this.$=ks(e.actions??{},n),N(this,j,e.tests?ta(e.tests,n):void 0),e.prep&&(N(this,J,e.prep.bind(this)),l(this,O)&&l(this,O).next(this.prep(this.value))),e.name&&typeof e.name=="string"&&N(this,K,e.name),e.res&&e.res instanceof Map&&e.res.forEach((i,o)=>this.res.set(o,i))}get subject(){return l(this,O)}get acts(){return this.$}prep(e){return l(this,J)?l(this,J).call(this,e,this.value):e}get name(){return l(this,K)||N(this,K,"forestry-store:"+`${Math.random()}`.split(".").pop()),l(this,K)}complete(){if(!this.isActive)return this.value;const e=this.value;return this.isActive=!1,l(this,O)&&l(this,O).complete(),e}next(e){if(!this.isActive)throw new Error("Cannot update completed store");if(!this.subject)throw new Error("Store requires subject -- or override of next()");const r=this.prep(e),{isValid:n,error:i}=this.validate(r);if(n){$(this,bt,Ae).call(this)?this.queuePendingValue(r):l(this,O).next(r);return}throw this.debug&&this.broadcast({action:"next-error",error:i,value:r}),st(i)}get suspendValidation(){return l(this,v).value.some(e=>e.suspendValidation)}transact(e,r){if(typeof e=="function"){this.transact({action:e,suspendValidation:!!r});return}const{action:n,suspendValidation:i}=e;let o="";try{let s=function(a){return n.call(u,a)};o=$(this,Ut,Yr).call(this,i);const u=this;s(this.value),$(this,Ft,Kr).call(this,o)}catch(s){throw o&&$(this,Vt,Wr).call(this,o),s}}observeTransStack(e){return l(this,v).subscribe(e)}queuePendingValue(e){const r=`${Math.random()}`.replace("0.",""),n=`level_${l(this,v).value.length}-${r}-trans`,i=[...l(this,v).value,{id:n,value:e,isTransaction:!1}];return l(this,v).next(i),n}dequeuePendingValue(e){if(l(this,v).value.findIndex(n=>n.id===e)===l(this,v).value.length-1&&!l(this,v).value.some(n=>n.isTransaction))return l(this,Rt).call(this)}get root(){return this}get isRoot(){return!0}broadcast(e,r){(r||!this.parent)&&this.receiver.next(e),this.root&&this.root!==this&&this.root.broadcast(e)}validate(e){if(this.suspendValidation)return{isValid:!0};if(Ls(this.schema))try{this.schema.parse(e)}catch(r){return{isValid:!1,error:st(r),source:"schema"}}return this.test(e)}isValid(e){return this.validate(e).isValid}test(e){let r;if(l(this,j))try{if(Array.isArray(l(this,j)))for(const n of l(this,j))r=n,$(this,vt,Se).call(this,n,e);else typeof l(this,j)=="function"&&(r=l(this,j),$(this,vt,Se).call(this,l(this,j),e))}catch(n){return{isValid:!1,value:e,error:st(n),testFn:r}}return{isValid:!0}}get value(){const e=l(this,v).value;if(e.length)return e[e.length-1].value;if(!l(this,O))throw new Error("Store requires subject or overload of value");return l(this,O).value}subscribe(e){return this.subject.pipe(Nr(Dr)).subscribe(e)}get(e){if(!e||Array.isArray(e)&&e.length===0)return this.value;const r=Array.isArray(e)?e:V(e).split(".");return yt(this.value,r)}set(e,r){const n=ut(this.value,i=>{Wt(i,e,r)});this.next(n)}mutate(e,r){if(!r||Array.isArray(r)&&r.length===0){const n=ut(this.value,e);return this.next(n),this.value}else{const n=Array.isArray(r)?r:V(r).split("."),i=ut(this.value,o=>{const s=yt(o,n);s!==void 0&&e(s)});return this.next(i),this.value}}}O=new WeakMap,J=new WeakMap,K=new WeakMap,vt=new WeakSet,Se=function(e,r){const n=e.call(this,r,this);if(n)throw st(n)},v=new WeakMap,Ft=new WeakSet,Kr=function(e){let r=!1;const n=l(this,v).value.map(i=>i.id===e?(r=!0,{...i,isTransaction:!1,suspendValidation:!1}):i);r&&l(this,v).next(n),$(this,Dt,qr).call(this)},Dt=new WeakSet,qr=function(){if(!l(this,v).value.some(e=>e.isTransaction)){const e=l(this,v).value.pop();l(this,v).next([]),e&&(this.broadcast({action:"checkTransComplete",phase:"next",value:e.value}),this.next(e.value))}},bt=new WeakSet,Ae=function(){return l(this,v).value.some(e=>e.isTransaction)},Rt=new WeakMap,Ut=new WeakSet,Yr=function(e=!1){const r=`${Math.random()}`.replace("0.",""),n=`level_${l(this,v).value.length}-${r}-trans`,i=[...l(this,v).value,{id:n,value:this.value,suspendValidation:e,isTransaction:!0}];return l(this,v).next(i),n},Vt=new WeakSet,Wr=function(e){const r=l(this,v).value.findIndex(n=>n.id===e);if(r>=0){const n=l(this,v).value.slice(0,r);l(this,v).next(n)}},j=new WeakMap;var Q;const Ie=class Ie extends Hr{constructor(r,n,i){if(!Bs(i))throw new Error("ForestBranches must have parents");const o=yt(i.value,n);super({...r,value:o},!0);A(this,Q,void 0);P(this,"receiver",new Gt);this.path=n,this.parent=i,N(this,Q,i.receiver.subscribe(s=>{this.handleMessage(s)}))}handleMessage(r){if(r&&typeof r=="object"&&r.type)switch(r.type){case"validate-all":this.validateAndReport();break;case"complete":this.complete();break}this.broadcast(r,!0)}get value(){var r;return yt((r=this.parent)==null?void 0:r.value,this.path)}validateAndReport(){const{isValid:r,error:n}=this.validate(this.value);if(!r){const i={type:"validation-failure",branchPath:this.path,error:typeof n=="string"?n:(n==null?void 0:n.toString())||"Unknown validation error",timestamp:Date.now()};this.root.broadcast(i)}}get root(){let r=this.parent;for(;!r.isRoot&&r.parent;)r=r.parent;return r}get isRoot(){return!this.parent}next(r){if(!this.isActive)throw new Error("Cannot update completed store");const n=this.prep?this.prep(r,this.value):r,{isValid:i,error:o}=this.validate(n);if(!i)throw o;this.parent?this.parent.set(this.path,n):super.next(n)}get subject(){const r=V(this.path);return this.parent.subject.pipe(dn(n=>Vo(n,r)),Nr(Dr))}subscribe(r){return this.subject.subscribe(r)}set(r,n){if(this.parent){const i=zt(this.path,r);return this.parent.set(i,n)}else{const i=Array.isArray(r)?r:V(r).split("."),o=ut(this.value,s=>{Wt(s,i,n)});return this.next(o)}}broadcast(r,n){n||this.isRoot?this.receiver.next(r):this.root&&this.root!==this?this.root.broadcast(r):console.warn("strange broadcast pattern; node that is not root has no parent")}branch(r,n){const i=zt(this.path,r),o=this.name+"."+V(r);return new Ie({name:o,...n},i,this)}complete(){if(!this.isActive)return this.value;const r={type:"complete",timestamp:Date.now()};this.broadcast(r,!0);const n=super.complete();return this.receiver.complete(),l(this,Q).unsubscribe(),n}destroy(){l(this,Q).unsubscribe()}};Q=new WeakMap;let Pe=Ie;var Lt,Xr;class va extends Hr{constructor(r){super(r);A(this,Lt);P(this,"path",[]);P(this,"parent",null);P(this,"isRoot",!0)}get root(){return this}complete(){if(!this.isActive)return this.value;const r={type:"complete",timestamp:Date.now()};return this.broadcast(r,!0),this.receiver.complete(),super.complete()}next(r){const n=this.prep?this.prep(r,this.value):r,{isValid:i,error:o}=this.validate(n);if(!i)throw this.debug&&console.error(`cannot update ${this.name} with `,n,o),st(o);const s=this.queuePendingValue(n);try{$(this,Lt,Xr).call(this,n),this.dequeuePendingValue(s)&&super.next(n)}catch(u){throw this.dequeuePendingValue(s),u}}set(r,n){const i=Array.isArray(r)?r:V(r).split("."),o=ut(this.value,s=>{Wt(s,i,n)});return this.next(o)}branch(r,n){const i=this.name+"."+V(r);return new Pe({name:i,...n},r,this)}}Lt=new WeakSet,Xr=function(r){let n=null;const i=this.receiver.subscribe(o=>{o&&o.type==="validation-failure"&&(n=`Branch ${V(o.branchPath)}: ${o.error}`)});try{const o={type:"set-pending",payload:r,timestamp:Date.now()};this.broadcast(o,!0);const s={type:"validate-all",timestamp:Date.now()};if(this.broadcast(s,!0),n)throw this.debug&&console.error("Branch validation failed:",n),new Error(`Validation failed: ${n}`)}finally{i.unsubscribe()}};export{va as F,Hr as S};
