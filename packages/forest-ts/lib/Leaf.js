"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Leaf=void 0;const types_1=require("./types"),rxjs_1=require("rxjs"),collect_1=require("@wonderlandlabs/collect");class Leaf{constructor(t,e,i){this.$tree=t,this.$collection=e,this.$identity=i,this.$joins={}}$subscribe(t){return this.$query({}).pipe((0,rxjs_1.map)(([t])=>t)).subscribe(t)}$query(t){return this.$getCollection.query(Object.assign(Object.assign({},t),{identity:this.$identity}))}get $getCollection(){return this.$tree.collection(this.$collection)}get $value(){if(this.$exists)return this.$getCollection.get(this.$identity);throw new Error("the record "+this.$identity+" has been removed from "+this.$collection)}get $exists(){return this.$getCollection.has(this.$identity)}toJSON(){if(!this.$exists)return{identity:this.$identity,collection:this.$collection,value:void 0,$exists:!1};const i={};return(0,collect_1.c)(this.$joins).forEach((t,e)=>{i[e]=t.map(t=>t.toJSON()).filter(types_1.isLeafJSON)}),{value:this.$value,identity:this.$identity,collection:this.$collection,joins:i}}}exports.Leaf=Leaf;